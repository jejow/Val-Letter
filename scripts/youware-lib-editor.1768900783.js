!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";const e=new class{isParent;customTargetWindow;customTargetOrigin;eventHandlers={};invokeHandlers={};pending;invokeCallbacks=new Map;allowedOrigins;iframeSelector;generateMessageId;logger;constructor(e){this.isParent=e.isParent,this.pending=new Map,this.allowedOrigins=e.allowedOrigins||["youware\\.app","youware-staging\\.app","yourware\\.app","yourware\\.so","youware\\.com","localhost|127\\.0\\.0\\.1","csb\\.app"],this.iframeSelector=e.iframeSelector||"#youware-runtime",this.generateMessageId=e.generateMessageId||this.defaultGenerateMessageId,this.logger=e.logger,this.logger?.info("MessageManager initialized",{envType:this.isParent?"parent":"child",allowedOrigins:this.allowedOrigins,iframeSelector:this.iframeSelector}),this.listen()}defaultGenerateMessageId(){return Date.now()+Math.random().toString(36).substring(2)}get targetWindow(){return this.customTargetWindow?this.customTargetWindow:"undefined"!=typeof window?this.isParent?document.querySelector(this.iframeSelector)?.contentWindow:window.parent:void 0}get targetOrigin(){return this.customTargetOrigin?this.customTargetOrigin:"*"}allowOrigin(e){const t=this.allowedOrigins.some(t=>new RegExp(t).test(e));return t||this.logger?.warn("Origin rejected",{origin:e,allowedPatterns:this.allowedOrigins}),t}setTarget(e){this.customTargetWindow=e.window,this.customTargetOrigin=e.origin,this.logger?.info("Target updated",{hasWindow:!!e.window,origin:e.origin})}addAllowedOrigin(e){this.allowedOrigins.includes(e)||(this.allowedOrigins.push(e),this.logger?.info("Added allowed origin pattern",{pattern:e,totalPatterns:this.allowedOrigins.length}))}removeAllowedOrigin(e){const t=this.allowedOrigins.indexOf(e);t>-1&&(this.allowedOrigins.splice(t,1),this.logger?.info("Removed allowed origin pattern",{pattern:e,totalPatterns:this.allowedOrigins.length}))}sendEvent(e,t,n=3,r=1e3){const i=this.generateMessageId(),o={id:i,type:"event",event:e,data:t};this.logger?.info("Sending event",{event:e,messageId:i,dataType:typeof t,maxRetries:n,timeout:r}),this.sendMessageWithRetry(o,n,r)}sendEventWithTransferable(e,t,n,r=3,i=1e3){const o=this.generateMessageId(),s={id:o,type:"event",event:e,data:t};this.logger?.info("Sending event with transferable",{event:e,messageId:o,dataType:typeof t,transferableCount:n.length,maxRetries:r,timeout:i}),this.sendMessageWithRetry(s,r,i,n)}invoke(e,t){return new Promise((n,r)=>{const i=this.generateMessageId(),o={id:i,type:"invoke",event:e,data:t};this.logger?.info("Invoking remote method",{event:e,messageId:i,dataType:typeof t}),this.invokeCallbacks.set(i,{resolve:n,reject:r});const s=setTimeout(()=>{if(this.invokeCallbacks.get(i)){this.invokeCallbacks.delete(i);const t=`Invoke ACK timeout: ${e}`;this.logger?.error(t,{event:e,messageId:i}),r(new Error(t))}},5e3);this.pending.set(i,{timer:s,attempt:0}),this.targetWindow?.postMessage(o,this.targetOrigin)})}invokeWithTransferable(e,t,n){return new Promise((r,i)=>{const o=this.generateMessageId(),s={id:o,type:"invoke",event:e,data:t};this.logger?.info("Invoking remote method with transferable",{event:e,messageId:o,dataType:typeof t,transferableCount:n.length}),this.invokeCallbacks.set(o,{resolve:r,reject:i});const a=setTimeout(()=>{if(this.invokeCallbacks.get(o)){this.invokeCallbacks.delete(o);const t=`Invoke ACK timeout: ${e}`;this.logger?.error(t,{event:e,messageId:o}),i(new Error(t))}},5e3);this.pending.set(o,{timer:a,attempt:0}),this.targetWindow?.postMessage(s,this.targetOrigin,n)})}sendMessageWithRetry(e,t,n,r){const i=(o=0)=>{if(o>0&&this.logger?.warn("Message retry attempt",{event:e.event,messageId:e.id,attempt:o+1,maxAttempts:t+1}),this.targetWindow?.postMessage(e,this.targetOrigin,r),"event"===e.type){const r=setTimeout(()=>{if(o>=t)return this.pending.delete(e.id),void this.logger?.error("Message failed after all retries",{event:e.event,messageId:e.id,totalAttempts:o+1});i(o+1)},n*2**o);this.pending.set(e.id,{timer:r,attempt:o})}};i()}listen(){"undefined"!=typeof window&&(this.logger?.info("Started listening for messages"),window.addEventListener("message",e=>{if(!this.allowOrigin(e.origin)||!e.data?.type||!e.data?.id)return;const t=e.data;switch(this.logger?.info("Received message",{type:t.type,event:t.event,messageId:t.id,origin:e.origin}),t.type){case"event":this.sendAck(t.id,e.origin);const n=this.eventHandlers[t.event];n&&n.length>0&&n.forEach(e=>{try{e(t.data)}catch(n){this.logger?.error("Event handler error",{event:t.event,error:n instanceof Error?n.message:String(n)})}});break;case"invoke":this.sendAck(t.id,e.origin),this.handleInvoke(t,e.origin);break;case"response":this.handleResponse(t);break;case"ack":this.handleAck(t)}}))}sendAck(e,t){const n={id:this.generateMessageId(),type:"ack",event:"ack",originalId:e};this.targetWindow?.postMessage(n,t)}async handleInvoke(e,t){try{const n=this.invokeHandlers[e.event];if(!n){const t=`No handler for invoke: ${e.event}`;throw this.logger?.error(t,{event:e.event,messageId:e.id}),new Error(t)}this.logger?.debug("Executing invoke handler",{event:e.event,messageId:e.id});const r=await n(e.data),i={id:this.generateMessageId(),type:"response",event:"response",originalId:e.id,data:r},o=this.extractTransferableFromResult(r);o.length>0?(this.logger?.debug("Sending response with transferable objects",{event:e.event,originalId:e.id,transferableCount:o.length}),this.targetWindow?.postMessage(i,t,o)):this.targetWindow?.postMessage(i,t)}catch(n){const r=n instanceof Error?n.message:String(n);this.logger?.error("Invoke handler failed",{event:e.event,messageId:e.id,error:r});const i={id:this.generateMessageId(),type:"response",event:"response",originalId:e.id,error:r};this.targetWindow?.postMessage(i,t)}}extractTransferableFromResult(e){const t=[];if(!e)return t;if(e.buffer instanceof ArrayBuffer)t.push(e.buffer);else if(e instanceof ArrayBuffer)t.push(e);else if("object"==typeof e)for(const n of Object.values(e))n instanceof ArrayBuffer?t.push(n):n&&"object"==typeof n&&"buffer"in n&&n.buffer instanceof ArrayBuffer&&t.push(n.buffer);return t}handleResponse(e){const t=this.invokeCallbacks.get(e.originalId);t?(e.error?(this.logger?.error("Invoke failed with error",{originalId:e.originalId,error:e.error}),t.reject(new Error(e.error))):(this.logger?.info("Invoke completed successfully",{originalId:e.originalId,resultType:typeof e.data}),t.resolve(e.data)),this.invokeCallbacks.delete(e.originalId)):this.logger?.warn("No callback found for response",{originalId:e.originalId})}handleAck(e){const{originalId:t}=e,n=this.pending.get(t);n?(clearTimeout(n.timer),this.pending.delete(t),this.logger?.debug("ACK received, cleared timeout",{originalId:t})):this.logger?.warn("Received ACK for unknown message",{originalId:t})}onEvent(e,t){const n=e;return this.eventHandlers[n]||(this.eventHandlers[n]=[]),this.eventHandlers[n].push(t),this.logger?.info("Registered event handler",{event:n,handlerCount:this.eventHandlers[n].length}),()=>{const e=this.eventHandlers[n];if(e){const r=e.indexOf(t);r>-1&&(e.splice(r,1),this.logger?.info("Removed specific event handler",{event:n,remainingHandlers:e.length}),0===e.length&&delete this.eventHandlers[n])}}}onInvoke(e,t){this.invokeHandlers[e]=t,this.logger?.info("Registered invoke handler",{event:e})}offInvoke(e){delete this.invokeHandlers[e],this.logger?.info("Removed invoke handler",{event:e})}updateLogConfig(e){void 0!==e.logger&&(this.logger=e.logger),this.logger?.info("Log configuration updated",e)}destroy(){this.logger?.info("Starting MessageManager cleanup"),this.pending.forEach((e,t)=>{clearTimeout(e.timer)}),this.pending.clear(),this.invokeCallbacks.forEach((e,t)=>{e.reject(new Error("MessageManager destroyed"))}),this.invokeCallbacks.clear(),this.eventHandlers={},this.invokeHandlers={},this.logger?.info("MessageManager destroyed")}}({isParent:!1});function t(e){try{const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4),r=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return(new TextDecoder).decode(n)}(t+n),[i,o]=r.split("@");if(!i||!o||"unknown"===o)return null;const[s,a]=o.split(":"),l=parseInt(s,10),c=parseInt(a,10);return isNaN(l)||isNaN(c)?null:{relativePath:i,line:l,column:c}}catch(t){return console.warn("parseElementId error:",e,t),null}}function n(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function r(e){const t={};if(e.style.cssText){e.style.cssText.split(";").filter(Boolean).forEach(e=>{const[n,r]=e.split(":").map(e=>e.trim());if(n&&r){const e=function(e){return e.replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}(n);t[e]=r}})}return t}function i(e,t){const n=[];return Object.entries(t).forEach(([t,r])=>{const i=e[t];i!==r&&(i?n.push({property:t,action:"modify",value:r,oldValue:i}):n.push({property:t,action:"add",value:r}))}),Object.entries(e).forEach(([e,r])=>{e in t||n.push({property:e,action:"remove",value:"",oldValue:r})}),n}function o(e,t){const r=t.filter(e=>"add"===e.action||"modify"===e.action),i=t.filter(e=>"remove"===e.action);r.forEach((t,r)=>{const i=n(t.property);e.style.setProperty(i,t.value)}),i.forEach((t,i)=>{const o=n(t.property);if(s=t.property,["margin","padding","border","borderWidth","borderStyle","borderColor","borderRadius","font","background","outline","transition","animation"].includes(s)){if(({margin:["marginTop","marginRight","marginBottom","marginLeft"],padding:["paddingTop","paddingRight","paddingBottom","paddingLeft"],border:["borderTop","borderRight","borderBottom","borderLeft"],borderWidth:["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],borderStyle:["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],borderColor:["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"]}[t.property]||[]).some(e=>r.some(t=>t.property===e)))return}var s;e.style.removeProperty(o)})}function s(e){if(!e)return e;try{const t=new URL(e),n=window.location.origin;return t.origin===n?t.pathname+t.search+t.hash:e}catch{return e}}function a(e){if(!e)return"";if(e===document.documentElement)return"/html";let t=null,n=e;for(;n&&n!==document.documentElement;){if(n.id){if(1===document.querySelectorAll(`#${CSS.escape(n.id)}`).length){t=n;break}}n=n.parentElement}if(t&&t!==e){const n=function(e,t){if(e===t)return"";let n="",r=e;for(;r&&r!==t;){const e=r.nodeName.toLowerCase();let t=1,i=r.previousElementSibling;for(;i;)i.nodeName===r.nodeName&&t++,i=i.previousElementSibling;const o=r.parentElement;let s=!1;if(o){s=Array.from(o.children).filter(e=>e.nodeName===r.nodeName).length>1}n=`/${e}${s?`[${t}]`:""}${n}`,r=r.parentElement}return n}(e,t);return`//*[@id="${t.id}"]${n}`}if(e.id){if(1===document.querySelectorAll(`#${CSS.escape(e.id)}`).length)return`//*[@id="${e.id}"]`}return function(e){if(!e)return"";if(e===document.documentElement)return"/html";let t="",n=e;for(;n&&n.nodeType===Node.ELEMENT_NODE;){const e=n.nodeName.toLowerCase();let r="",i=1,o=n.previousElementSibling;for(;o;)o.nodeName===n.nodeName&&i++,o=o.previousElementSibling;if(n.id){const e=n.parentElement;r=e?1===Array.from(e.children).filter(e=>e.nodeName===n.nodeName&&e.id===n.id).length?`[@id="${n.id}"]`:`[${i}]`:`[@id="${n.id}"]`}else if(n.className&&"string"==typeof n.className&&""!==n.className.trim()){const e=n.parentElement;r=e?1===Array.from(e.children).filter(e=>e.nodeName===n.nodeName&&e.className===n.className).length?`[@class="${n.className}"]`:`[${i}]`:`[@class="${n.className}"]`}else{const e=n.parentElement;let t=1;e&&(t=Array.from(e.children).filter(e=>e.nodeName===n.nodeName).length),r=t>1?`[${i}]`:""}t=`/${e}${r}${t}`,n=n.parentElement}return t}(e)}function l(e){const t=`[data-yw="${e}"]`;return Array.from(document.querySelectorAll(t))}function c(e){const t=e.getAttribute("data-yw");return t||{xpath:a(e)}}function u(e){return"string"==typeof e}function d(e,t){return"string"==typeof e&&"string"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&e.xpath===t.xpath}function h(e){return"string"==typeof e?e:`xpath:${e.xpath}`}function g(e){return!!e.hasAttribute("data-yw-t")||1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE}function m(e){if(g(e))return!0;return Array.from(e.childNodes).some(e=>e.nodeType===Node.TEXT_NODE&&""!==e.textContent?.trim()||e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("data-yw-auto"))}function f(e){const n=c(e),i=e.tagName.toLowerCase(),o=m(e),l="IMG"===e.tagName,d=r(e),h=window.getComputedStyle(e),g=Object.fromEntries(["fontSize","fontWeight","color","textAlign","backgroundColor","borderRadius","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft"].map(e=>[e,h[e]])),f=e.getBoundingClientRect(),p={x:f.x,y:f.y,width:f.width,height:f.height,top:f.top,left:f.left,bottom:f.bottom,right:f.right},y=u(n)&&t(n)||void 0;return{tagName:i,xpath:a(e),outerHtml:e.outerHTML?.length<500?e.outerHTML:"",urlPath:window.location.pathname,id:n,boundingRect:p,textCodeEdit:e.hasAttribute("data-yw-t"),imageCodeEdit:e.hasAttribute("data-yw-i"),styleCodeEdit:e.hasAttribute("data-yw-s"),linkCodeEdit:e.hasAttribute("data-yw-l"),codePosition:y,styleInfo:{inlineStyle:d,computedStyle:g},textInfo:{text:o&&e.textContent?.trim()||"",isTextEditable:o},imageInfo:{imageUrl:l?s(e.src):"",isImageEditable:l},linkInfo:{href:(()=>{let t;return t="A"===e.tagName?e.href:e.getAttribute("data-yw-href")||void 0,t?s(t):t})()}}}class p{constructor(e,t,n,r){this.identifier=e,this.elements=t,this.newText=n,this.originalTexts=new Map,this.elements.forEach(e=>{const t=void 0!==r?r:e.textContent?.trim()||"";this.originalTexts.set(e,t)})}execute(){this.elements.forEach(e=>{e.textContent!==this.newText&&(e.textContent=this.newText)})}undo(){this.elements.forEach(e=>{const t=this.originalTexts.get(e);void 0!==t&&(e.textContent=t)})}getType(){return"change-text"}getModificationData(){return{value:this.newText,oldValue:this.originalTexts.get(this.elements[0])||""}}}class y{constructor(e,t,n){this.identifier=e,this.elementGroup=t,this.newStyles=n,this.originalStyles=new Map,this.elementGroup.forEach(e=>{const t=r(e);this.originalStyles.set(e,t)})}execute(){this.elementGroup.forEach(e=>{o(e,i(r(e),this.newStyles))})}undo(){this.elementGroup.forEach(e=>{const t=this.originalStyles.get(e);if(t){o(e,i(r(e),t))}})}getType(){return"change-style"}getModificationData(){return{value:this.newStyles,oldValue:this.originalStyles.get(this.elementGroup[0])}}}class v{constructor(e,t,n){this.identifier=e,this.elements=t,this.newImageUrl=n,this.originalUrls=new Map,this.newImageUrl=s(this.newImageUrl),this.elements.forEach(e=>{if("IMG"===e.tagName){const t=e.src;this.originalUrls.set(e,t)}})}execute(){this.elements.forEach(e=>{"IMG"===e.tagName&&(e.src=this.newImageUrl)})}undo(){this.elements.forEach(e=>{if("IMG"===e.tagName){const t=this.originalUrls.get(e);void 0!==t&&(e.src=t)}})}getType(){return"change-image-url"}getModificationData(){const e=this.originalUrls.get(this.elements[0]);return{value:this.newImageUrl,oldValue:e?s(e):void 0}}}class w{constructor(e,t,n){this.identifier=e,this.elements=t,this.newHref=n,this.originalHrefs=new Map,this.newHref=s(this.newHref),this.elements.forEach(e=>{if("a"===e.tagName.toLowerCase()){const t=e.href||"";this.originalHrefs.set(e,t)}else{const t=e.getAttribute("data-yw-href")||"";this.originalHrefs.set(e,t)}})}execute(){this.elements.forEach(e=>{"a"===e.tagName.toLowerCase()?e.href=this.newHref:e.setAttribute("data-yw-href",this.newHref)})}undo(){this.elements.forEach(e=>{const t=this.originalHrefs.get(e);void 0!==t&&("a"===e.tagName.toLowerCase()?e.href=t:t?e.setAttribute("data-yw-href",t):e.removeAttribute("data-yw-href"))})}getType(){return"add-link"}getModificationData(){const e=this.originalHrefs.get(this.elements[0]);return{value:this.newHref,oldValue:e?s(e):void 0}}}class E{constructor(e,t){this.identifier=e,this.elements=t}execute(){this.elements.forEach(e=>{e.classList.add("yw-ve-deleted")})}undo(){this.elements.forEach(e=>{e.classList.remove("yw-ve-deleted")})}getType(){return"delete-element"}getModificationData(){return{value:!0}}}class b{constructor(){this.originalElementInfos=new Map,this.commandHistory=[],this.redoStack=[]}getCommandsForElement(e){return this.commandHistory.filter(t=>d(t.identifier,e))}saveElementInfo(e){const t=f(e),n=h(t.id);return this.originalElementInfos.has(n)||this.originalElementInfos.set(n,t),t}executeCommand(e){e.execute(),this.commandHistory.push(e),this.redoStack=[]}undoElement(e){const t=this.getCommandsForElement(e);[...t].reverse().forEach(e=>{e.undo()}),this.commandHistory=this.commandHistory.filter(e=>!t.includes(e))}getOriginalElementInfo(e){const t=h(e);return this.originalElementInfos.get(t)||null}clearAllHistory(){this.originalElementInfos.clear(),this.commandHistory=[],this.redoStack=[]}getModifiedElementKeys(){const e=new Set;return this.commandHistory.forEach(t=>{e.add(h(t.identifier))}),Array.from(e)}revertAllModifiedElements(){this.getModifiedElementKeys().forEach(e=>{const t=e.startsWith("xpath:")?{xpath:e.substring(6)}:e;this.undoElement(t)})}getAllModifications(){const e=[],t=new Set;for(const n of this.commandHistory){const r=h(n.identifier);if(!t.has(r)){t.add(r);const i=this.getCommandsForElement(n.identifier),o=this.extractModificationsFromCommands(i);if(o.length>0){const t=this.createVisualEdit(n.identifier,o);t&&e.push(t)}}}return e}extractModificationsFromCommands(e){if(0===e.length)return[];if(e[e.length-1]instanceof E)return[{type:"delete-element",value:"true"}];const t=new Map;for(const r of e){const e=r.getType();"delete-element"!==e&&t.set(e,r)}const n=[];return t.forEach((e,t)=>{const r=e.getModificationData();switch(t){case"change-text":n.push({type:"change-text",...r});break;case"change-style":n.push({type:"change-style",...r});break;case"change-image-url":n.push({type:"change-image-url",...r});break;case"add-link":n.push({type:"add-link",...r})}}),n}createVisualEdit(e,n){if(0===n.length)return null;const r=this.getOriginalElementInfo(e);if(!r)return null;let i=null,o=!1;"string"==typeof e&&(i=t(e),o=null!==i);const{codeEditModifications:s,promptEditModifications:a}=this.splitModificationsByCapabilities(n,r),l={id:h(e),tag:r.tagName};if(o&&i&&s.length>0){const e={location:i,modifications:s};l.code_edit=JSON.stringify(e)}if(a.length>0){let e;e=o&&i?i:{urlPath:r.urlPath,xpath:r.xpath,outerHtml:r.outerHtml};const t={location:e,modifications:a};l.prompt_edit=JSON.stringify(t)}return l.code_edit||l.prompt_edit?l:null}splitModificationsByCapabilities(e,t){const n=[],r=[];for(const i of e)this.canModificationUseCodeEdit(i,t)?n.push(i):r.push(i);return{codeEditModifications:n,promptEditModifications:r}}canModificationUseCodeEdit(e,t){switch(e.type){case"change-text":return t.textCodeEdit;case"change-image-url":return t.imageCodeEdit;case"change-style":return t.styleCodeEdit;case"add-link":return t.linkCodeEdit;case"delete-element":return"string"==typeof t.id;default:return!1}}undo(){if(0===this.commandHistory.length)return!1;const e=this.commandHistory.pop();return e.undo(),this.redoStack.push(e),!0}redo(){if(0===this.redoStack.length)return!1;const e=this.redoStack.pop();return e.execute(),this.commandHistory.push(e),!0}canUndo(){return this.commandHistory.length>0}canRedo(){return this.redoStack.length>0}}var S="object"==typeof global&&global&&global.Object===Object&&global,C="object"==typeof self&&self&&self.Object===Object&&self,M=S||C||Function("return this")(),_=M.Symbol,L=Object.prototype,k=L.hasOwnProperty,R=L.toString,T=_?_.toStringTag:void 0;var A=Object.prototype.toString;var O=_?_.toStringTag:void 0;function P(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":O&&O in Object(e)?function(e){var t=k.call(e,T),n=e[T];try{e[T]=void 0;var r=!0}catch(o){}var i=R.call(e);return r&&(t?e[T]=n:delete e[T]),i}(e):function(e){return A.call(e)}(e)}var I=/\s/;var x=/^\s+/;function H(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&I.test(e.charAt(t)););return t}(e)+1).replace(x,""):e}function N(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var j=/^[-+]0x[0-9a-f]+$/i,D=/^0b[01]+$/i,$=/^0o[0-7]+$/i,B=parseInt;function U(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==P(e)}(e))return NaN;if(N(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=N(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=H(e);var n=D.test(e);return n||$.test(e)?B(e.slice(2),n?2:8):j.test(e)?NaN:+e}var F=function(){return M.Date.now()},z=Math.max,W=Math.min;function G(e,t,n){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=r,o=i;return r=i=void 0,c=t,s=e.apply(o,n)}function m(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function f(){var e=F();if(m(e))return p(e);a=setTimeout(f,function(e){var n=t-(e-l);return d?W(n,o-(e-c)):n}(e))}function p(e){return a=void 0,h&&r?g(e):(r=i=void 0,s)}function y(){var e=F(),n=m(e);if(r=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(f,t),u?g(e):s}(l);if(d)return clearTimeout(a),a=setTimeout(f,t),g(l)}return void 0===a&&(a=setTimeout(f,t)),s}return t=U(t)||0,N(n)&&(u=!!n.leading,o=(d="maxWait"in n)?z(U(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=i=a=void 0},y.flush=function(){return void 0===a?s:p(F())},y}class q{constructor(){this.target=null,this.visible=!1,this.BORDER_WIDTH=1,this.timeout=null,this.updatePosition=G(()=>{this.doUpdatePosition()},32),this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.pointerEvents="none",this.container.style.zIndex="9999",this.setupObservers()}setupObservers(){this.resizeObserver=new ResizeObserver(this.updatePosition),this.mutationObserver=new MutationObserver(this.updatePosition),window.addEventListener("resize",this.updatePosition)}doUpdatePosition(){if(!this.target)return;const e=this.target.getBoundingClientRect(),t=window.getComputedStyle(this.target);this.container.style.boxSizing="content-box";const n=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),r=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(0,Math.min(e.top+window.scrollY-this.BORDER_WIDTH,n-this.BORDER_WIDTH));this.container.style.top=`${i}px`;const o=Math.max(0,Math.min(e.left+window.scrollX-this.BORDER_WIDTH,r-this.BORDER_WIDTH));this.container.style.left=`${o}px`;const s=Math.max(0,Math.min(e.width,r-o-2*this.BORDER_WIDTH));this.container.style.width=`${s}px`;const a=Math.max(0,Math.min(e.height,n-i-2*this.BORDER_WIDTH));this.container.style.height=`${a}px`,this.container.style.borderRadius=t.borderRadius}show(e){this.target=e,this.updatePosition(),this.timeout=setTimeout(()=>{document.body.appendChild(this.container)},100),this.visible=!0,this.target&&(this.resizeObserver?.observe(this.target),this.mutationObserver?.observe(this.target,{attributes:!0,childList:!0,subtree:!0}))}cleanup(){this.target&&this.resizeObserver?.unobserve(this.target),this.container.remove(),this.target=null,this.visible=!1,this.resizeObserver?.disconnect(),this.mutationObserver?.disconnect(),window.removeEventListener("resize",this.updatePosition),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}isVisible(){return this.visible}getTarget(){return this.target}}class V extends q{constructor(){super(),this.container.className="ve-hover-overlay",this.container.style.border="1px dashed #55644A",this.container.style.backgroundColor="rgba(85, 100, 74, 0.12)"}}class K extends q{constructor(){super(),this.tagPosition="top-left",this.container.className="ve-selection-overlay",this.container.style.border="1px solid #55644A",this.container.style.backgroundColor="transparent",this.tagElement=document.createElement("div"),this.tagElement.className="ve-element-tag",this.tagElement.style.position="absolute",this.tagElement.style.padding="2px",this.tagElement.style.backgroundColor="#55644A",this.tagElement.style.color="#fff",this.tagElement.style.borderRadius="2px",this.tagElement.style.fontSize="10px",this.tagElement.style.fontFamily="monospace",this.tagElement.style.fontWeight="700",this.tagElement.style.lineHeight="normal",this.tagElement.style.textTransform="uppercase",this.tagElement.style.whiteSpace="nowrap",this.container.appendChild(this.tagElement)}show(e){super.show(e),this.tagElement.textContent=e.tagName.toLowerCase(),this.updateTagPosition()}doUpdatePosition(){super.doUpdatePosition(),this.updateTagPosition()}updateTagPosition(){if(!this.target)return;const e=function(e){const t=e.getBoundingClientRect(),n={width:window.innerWidth,height:window.innerHeight};return{rect:t,viewport:n,spaceTop:t.top,spaceBottom:n.height-t.bottom,spaceLeft:t.left,spaceRight:n.width-t.right}}(this.target),{rect:t,spaceTop:n,spaceBottom:r,spaceLeft:i,spaceRight:o}=e;this.tagElement.style.visibility="hidden",this.tagElement.style.position="absolute",this.tagElement.style.top="0",this.tagElement.style.left="0";const s=this.tagElement.getBoundingClientRect(),a=s.width,l=s.height,c=[{position:"top-left",top:-l-3,left:-1,priority:n>=l&&i>=a?4:0},{position:"top-right",top:-l-3,left:t.width-a+1,priority:n>=l&&o>=a?3:0},{position:"bottom-left",top:t.height+3,left:-1,priority:r>=l+3&&i>=a?2:0},{position:"bottom-right",top:t.height+3,left:t.width-a+1,priority:r>=l+3&&o>=a?2:0},{position:"inside",top:2,left:2,priority:1}].reduce((e,t)=>t.priority>e.priority?t:e);this.tagPosition=c.position,this.tagElement.style.top=`${c.top}px`,this.tagElement.style.left=`${c.left}px`,this.tagElement.style.visibility="visible","inside"===this.tagPosition?(this.tagElement.style.backgroundColor="rgba(85, 100, 74, 0.9)",this.tagElement.style.backdropFilter="blur(2px)"):(this.tagElement.style.backgroundColor="#55644A",this.tagElement.style.backdropFilter="none");const u=Math.max(60,t.width-4);a>u?(this.tagElement.style.maxWidth=`${u}px`,this.tagElement.style.overflow="hidden",this.tagElement.style.textOverflow="ellipsis"):(this.tagElement.style.maxWidth="none",this.tagElement.style.overflow="visible",this.tagElement.style.textOverflow="unset")}}class X{constructor(){this.state={isVisualEditingEnabled:!1,selectedElement:null,hoveredElement:null,multiSelectedElements:new Map},this.hoverOverlays=new Map,this.selectionOverlays=new Map}setVisualEditingEnabled(e){this.state.isVisualEditingEnabled=e,e||this.clearAllStates()}isVisualEditingEnabled(){return this.state.isVisualEditingEnabled}setSelectedElement(e){if(this.clearSelectedElement(),e){const t=c(e),n=u(t)?l(t):[e];this.state.selectedElement={identifier:t,element:e,elementGroup:n},this.state.multiSelectedElements.clear(),this.state.multiSelectedElements.set(t,e),n.forEach((e,n)=>{const r=h(t),i=0===n?r:`${r}_group_${n}`,o=new K;o.show(e),this.selectionOverlays.set(i,o)})}else this.state.selectedElement=null}getSelectedElement(){return this.state.selectedElement}clearSelectedElement(){if(this.state.selectedElement){const e=h(this.state.selectedElement.identifier);Array.from(this.selectionOverlays.keys()).filter(t=>t===e||t.startsWith(`${e}_group_`)).forEach(e=>{const t=this.selectionOverlays.get(e);t&&(t.cleanup(),this.selectionOverlays.delete(e))})}this.state.selectedElement=null}setHoveredElement(e,t=[]){this.clearHoveredElement(),e&&t.length>0?(this.state.hoveredElement={element:e,elementGroup:t},t.forEach((e,t)=>{const n=`hover_${t}`,r=new V;r.show(e),this.hoverOverlays.set(n,r)})):this.state.hoveredElement=null}getHoveredElement(){return this.state.hoveredElement}clearHoveredElement(){this.state.hoveredElement&&(this.hoverOverlays.forEach(e=>{e.cleanup()}),this.hoverOverlays.clear()),this.state.hoveredElement=null}addMultiSelectedElement(e,t){this.state.multiSelectedElements.set(e,t);(u(e)?l(e):[t]).forEach((t,n)=>{const r=h(e),i=0===n?r:`${r}_group_${n}`,o=new K;o.show(t),this.selectionOverlays.set(i,o)})}removeMultiSelectedElement(e){if(this.state.multiSelectedElements.get(e)){const t=h(e);Array.from(this.selectionOverlays.keys()).filter(e=>e===t||e.startsWith(`${t}_group_`)).forEach(e=>{const t=this.selectionOverlays.get(e);t&&(t.cleanup(),this.selectionOverlays.delete(e))}),this.state.multiSelectedElements.delete(e)}}clearMultiSelectedElements(){this.state.multiSelectedElements.forEach((e,t)=>{const n=h(t);Array.from(this.selectionOverlays.keys()).filter(e=>e===n||e.startsWith(`${n}_group_`)).forEach(e=>{const t=this.selectionOverlays.get(e);t&&(t.cleanup(),this.selectionOverlays.delete(e))})}),this.state.multiSelectedElements.clear()}toggleMultiSelectedElement(e){const t=c(e);this.state.multiSelectedElements.has(t)?this.removeMultiSelectedElement(t):this.addMultiSelectedElement(t,e)}getMultiSelectedElements(){return this.state.multiSelectedElements}convertSingleToMultiSelection(){if(this.state.selectedElement){const{identifier:e,element:t}=this.state.selectedElement;this.state.multiSelectedElements.set(e,t),this.state.selectedElement=null}}clearAllSelections(){this.clearSelectedElement(),this.clearMultiSelectedElements(),this.clearHoveredElement()}clearAllStates(){this.clearSelectedElement(),this.clearHoveredElement(),this.clearMultiSelectedElements()}getState(){return this.state}}class J{constructor(e){this.stateManager=e,this.onTextChange=null,this.onEditStart=null,this.onEditEnd=null,this.keydownHandler=null,this.initialText="",this.inlineEditingElement=null,this.editStartTime=0}setTextChangeHandler(e){this.onTextChange=e}setEditStartHandler(e){this.onEditStart=e}setEditEndHandler(e){this.onEditEnd=e}checkClickElement(e){let t=e.target,n=t;if(t.hasAttribute("data-yw-auto")&&t.parentElement&&(t=t.parentElement),this.inlineEditingElement){if(e.target===this.inlineEditingElement)return{selectTarget:t,editTarget:n,checkStatus:"click_same"};this.endEditing()}if(!n.hasAttribute("data-yw-t")&&!n.hasAttribute("data-yw-auto")&&!g(n)&&m(n)){const t=this.getClickedTextNode(n,e);t&&(n=this.wrapTextNodeTemporarily(t,n))}const r=g(n);return r&&this.startEditing(n,e),{selectTarget:t,editTarget:n,checkStatus:r?"start_editing":"none"}}startEditing(e,t){this.initialText=e.textContent?.trim()||"",this.editStartTime=Date.now(),this.inlineEditingElement=e,e.contentEditable="plaintext-only",this.onEditStart&&this.onEditStart(e,this.initialText),this.keydownHandler=this.createKeydownHandler(e),e.addEventListener("keydown",this.keydownHandler,{capture:!0});const n=window.getComputedStyle(e).color;this.isTransparentColor(n)&&e.setAttribute("data-set-caret",""),e.focus(),t&&this.setCursorPosition(e,t)}endEditing(){const e=this.inlineEditingElement;if(e){const t=e.textContent?.trim()||"",n=Date.now()-this.editStartTime;this.onEditEnd&&this.onEditEnd(e,t,this.initialText,n),t!==this.initialText&&this.onTextChange&&this.onTextChange(e,t,this.initialText),this.keydownHandler&&(e.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null),e.contentEditable="inherit",this.inlineEditingElement=null,this.editStartTime=0}}isEditing(){return null!==this.inlineEditingElement}getEditingElement(){return this.inlineEditingElement}createKeydownHandler(e){return e=>{e.stopPropagation(),e.stopImmediatePropagation(),"Enter"===e.key&&(e.preventDefault(),this.endEditing())}}isTransparentColor(e){return"transparent"===e||"rgba(0, 0, 0, 0)"===e||Boolean(e.match(/rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*0\s*\)/))}setCursorPosition(e,t){if(document.caretPositionFromPoint){const e=document.caretPositionFromPoint(t.clientX,t.clientY);if(e){const t=document.createRange();t.setStart(e.offsetNode,e.offset),t.collapse(!0);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}}else if("caretRangeFromPoint"in document&&"function"==typeof document.caretRangeFromPoint){const e=(0,document.caretRangeFromPoint)(t.clientX,t.clientY);if(e){const t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}}}getClickedTextNode(e,t){const n=Array.from(e.childNodes);for(const r of n)if(r.nodeType===Node.TEXT_NODE&&r.textContent?.trim()){const e=document.createRange();e.selectNodeContents(r);const n=e.getClientRects();for(let i=0;i<n.length;i++){const e=n[i];if(t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom)return r}}return null}wrapTextNodeTemporarily(e,t){const n=document.createElement("span");return n.setAttribute("data-yw-auto",""),n.textContent=e.textContent,t.replaceChild(n,e),n}destroy(){this.endEditing(),this.onTextChange=null,this.onEditStart=null,this.onEditEnd=null,this.keydownHandler=null,this.initialText="",this.editStartTime=0}}class Y{constructor(){this.preview=null}setPreviewState(e,t,n){this.preview={elementIdentifier:e,elementGroup:t,originalStyles:n}}getPreviewState(){return this.preview}clearPreviewState(){this.preview=null}previewStyles(e,t,n){const s=this.getPreviewState();if(s&&!d(s.elementIdentifier,e)&&this.cancelPreview(),!s||!d(s.elementIdentifier,e)){const n=new Map;t.forEach(e=>{n.set(e,r(e))}),this.setPreviewState(e,t,n)}const a=this.getPreviewState();a&&t.forEach(e=>{o(e,i(a.originalStyles.get(e)||{},n))})}cancelPreview(e){const t=this.getPreviewState();t&&(e&&!d(t.elementIdentifier,e)||(t.elementGroup.forEach(e=>{const n=t.originalStyles.get(e);if(n){o(e,i(r(e),n))}}),this.clearPreviewState()))}hasActivePreview(){return null!==this.getPreviewState()}getActivePreviewElementIdentifier(){const e=this.getPreviewState();return e?.elementIdentifier||null}clearAllPreviews(){this.cancelPreview()}destroy(){this.clearAllPreviews()}}class Z{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,t){this.keyToValue.set(e,t),this.valueToKey.set(t,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class Q{constructor(e){this.generateIdentifier=e,this.kv=new Z}register(e,t){this.kv.getByValue(e)||(t||(t=this.generateIdentifier(e)),this.kv.set(t,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}}class ee extends Q{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,t){"object"==typeof t?(t.allowProps&&this.classToAllowedProps.set(e,t.allowProps),super.register(e,t.identifier)):super.register(e,t)}getAllowedProps(e){return this.classToAllowedProps.get(e)}}function te(e,t){const n=function(e){if("values"in Object)return Object.values(e);const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}(e);if("find"in n)return n.find(t);const r=n;for(let i=0;i<r.length;i++){const e=r[i];if(t(e))return e}}function ne(e,t){Object.entries(e).forEach(([e,n])=>t(n,e))}function re(e,t){return-1!==e.indexOf(t)}function ie(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(t(r))return r}}class oe{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return te(this.transfomers,t=>t.isApplicable(e))}findByName(e){return this.transfomers[e]}}const se=e=>void 0===e,ae=e=>"object"==typeof e&&null!==e&&(e!==Object.prototype&&(null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Object.prototype)),le=e=>ae(e)&&0===Object.keys(e).length,ce=e=>Array.isArray(e),ue=e=>e instanceof Map,de=e=>e instanceof Set,he=e=>"Symbol"===(e=>Object.prototype.toString.call(e).slice(8,-1))(e),ge=e=>"number"==typeof e&&isNaN(e),me=e=>(e=>"boolean"==typeof e)(e)||(e=>null===e)(e)||se(e)||(e=>"number"==typeof e&&!isNaN(e))(e)||(e=>"string"==typeof e)(e)||he(e),fe=e=>e.replace(/\./g,"\\."),pe=e=>e.map(String).map(fe).join("."),ye=e=>{const t=[];let n="";for(let i=0;i<e.length;i++){let r=e.charAt(i);if("\\"===r&&"."===e.charAt(i+1)){n+=".",i++;continue}"."===r?(t.push(n),n=""):n+=r}const r=n;return t.push(r),t};function ve(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}const we=[ve(se,"undefined",()=>null,()=>{}),ve(e=>"bigint"==typeof e,"bigint",e=>e.toString(),e=>"undefined"!=typeof BigInt?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),ve(e=>e instanceof Date&&!isNaN(e.valueOf()),"Date",e=>e.toISOString(),e=>new Date(e)),ve(e=>e instanceof Error,"Error",(e,t)=>{const n={name:e.name,message:e.message};return t.allowedErrorProps.forEach(t=>{n[t]=e[t]}),n},(e,t)=>{const n=new Error(e.message);return n.name=e.name,n.stack=e.stack,t.allowedErrorProps.forEach(t=>{n[t]=e[t]}),n}),ve(e=>e instanceof RegExp,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),n=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,n)}),ve(de,"set",e=>[...e.values()],e=>new Set(e)),ve(ue,"map",e=>[...e.entries()],e=>new Map(e)),ve(e=>{return ge(e)||((t=e)===1/0||t===-1/0);var t},"number",e=>ge(e)?"NaN":e>0?"Infinity":"-Infinity",Number),ve(e=>0===e&&1/e==-1/0,"number",()=>"-0",Number),ve(e=>e instanceof URL,"URL",e=>e.toString(),e=>new URL(e))];function Ee(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}const be=Ee((e,t)=>{if(he(e)){return!!t.symbolRegistry.getIdentifier(e)}return!1},(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,n)=>{const r=n.symbolRegistry.getValue(t[1]);if(!r)throw new Error("Trying to deserialize unknown symbol");return r}),Se=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Ce=Ee(e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const n=Se[t[1]];if(!n)throw new Error("Trying to deserialize unknown typed array");return new n(e)});function Me(e,t){if(e?.constructor){return!!t.classRegistry.getIdentifier(e.constructor)}return!1}const _e=Ee(Me,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const n=t.classRegistry.getAllowedProps(e.constructor);if(!n)return{...e};const r={};return n.forEach(t=>{r[t]=e[t]}),r},(e,t,n)=>{const r=n.classRegistry.getValue(t[1]);if(!r)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(r.prototype),e)}),Le=Ee((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,n)=>{const r=n.customTransformerRegistry.findByName(t[1]);if(!r)throw new Error("Trying to deserialize unknown custom value");return r.deserialize(e)}),ke=[_e,be,Le,Ce],Re=(e,t)=>{const n=ie(ke,n=>n.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation(e,t)};const r=ie(we,n=>n.isApplicable(e,t));return r?{value:r.transform(e,t),type:r.annotation}:void 0},Te={};we.forEach(e=>{Te[e.annotation]=e});const Ae=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const n=e.keys();for(;t>0;)n.next(),t--;return n.next().value};function Oe(e){if(re(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(re(e,"prototype"))throw new Error("prototype is not allowed as a property");if(re(e,"constructor"))throw new Error("constructor is not allowed as a property")}const Pe=(e,t,n)=>{if(Oe(t),0===t.length)return n(e);let r=e;for(let o=0;o<t.length-1;o++){const e=t[o];if(ce(r)){r=r[+e]}else if(ae(r))r=r[e];else if(de(r)){r=Ae(r,+e)}else if(ue(r)){if(o===t.length-2)break;const n=+e,i=0===+t[++o]?"key":"value",s=Ae(r,n);switch(i){case"key":r=s;break;case"value":r=r.get(s)}}}const i=t[t.length-1];if(ce(r)?r[+i]=n(r[+i]):ae(r)&&(r[i]=n(r[i])),de(r)){const e=Ae(r,+i),t=n(e);e!==t&&(r.delete(e),r.add(t))}if(ue(r)){const e=+t[t.length-2],o=Ae(r,e);switch(0===+i?"key":"value"){case"key":{const e=n(o);r.set(e,r.get(o)),e!==o&&r.delete(o);break}case"value":r.set(o,n(r.get(o)))}}return e};function Ie(e,t,n=[]){if(!e)return;if(!ce(e))return void ne(e,(e,r)=>Ie(e,t,[...n,...ye(r)]));const[r,i]=e;i&&ne(i,(e,r)=>{Ie(e,t,[...n,...ye(r)])}),t(r,n)}function xe(e,t,n){return Ie(t,(t,r)=>{e=Pe(e,r,e=>((e,t,n)=>{if(!ce(t)){const r=Te[t];if(!r)throw new Error("Unknown transformation: "+t);return r.untransform(e,n)}switch(t[0]){case"symbol":return be.untransform(e,t,n);case"class":return _e.untransform(e,t,n);case"custom":return Le.untransform(e,t,n);case"typed-array":return Ce.untransform(e,t,n);default:throw new Error("Unknown transformation: "+t)}})(e,t,n))}),e}function He(e,t){function n(t,n){const r=((e,t)=>{Oe(t);for(let n=0;n<t.length;n++){const r=t[n];if(de(e))e=Ae(e,+r);else if(ue(e)){const i=+r,o=0===+t[++n]?"key":"value",s=Ae(e,i);switch(o){case"key":e=s;break;case"value":e=e.get(s)}}else e=e[r]}return e})(e,ye(n));t.map(ye).forEach(t=>{e=Pe(e,t,()=>r)})}if(ce(t)){const[r,i]=t;r.forEach(t=>{e=Pe(e,ye(t),()=>e)}),i&&ne(i,n)}else ne(t,n);return e}const Ne=(e,t,n,r,i=[],o=[],s=new Map)=>{const a=me(e);if(!a){!function(e,t,n){const r=n.get(e);r?r.push(t):n.set(e,[t])}(e,i,t);const n=s.get(e);if(n)return r?{transformedValue:null}:n}if(!((e,t)=>ae(e)||ce(e)||ue(e)||de(e)||Me(e,t))(e,n)){const t=Re(e,n),r=t?{transformedValue:t.value,annotations:[t.type]}:{transformedValue:e};return a||s.set(e,r),r}if(re(o,e))return{transformedValue:null};const l=Re(e,n),c=l?.value??e,u=ce(c)?[]:{},d={};ne(c,(a,l)=>{if("__proto__"===l||"constructor"===l||"prototype"===l)throw new Error(`Detected property ${l}. This is a prototype pollution risk, please remove it from your object.`);const c=Ne(a,t,n,r,[...i,l],[...o,e],s);u[l]=c.transformedValue,ce(c.annotations)?d[l]=c.annotations:ae(c.annotations)&&ne(c.annotations,(e,t)=>{d[fe(l)+"."+t]=e})});const h=le(d)?{transformedValue:u,annotations:l?[l.type]:void 0}:{transformedValue:u,annotations:l?[l.type,d]:d};return a||s.set(e,h),h};function je(e){return Object.prototype.toString.call(e).slice(8,-1)}function De(e){return"Array"===je(e)}function $e(e,t={}){if(De(e))return e.map(e=>$e(e,t));if(!function(e){if("Object"!==je(e))return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}(e))return e;return[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)].reduce((n,r)=>{if(De(t.props)&&!t.props.includes(r))return n;return function(e,t,n,r,i){const o={}.propertyIsEnumerable.call(r,t)?"enumerable":"nonenumerable";"enumerable"===o&&(e[t]=n),i&&"nonenumerable"===o&&Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}(n,r,$e(e[r],t),e,t.nonenumerable),n},{})}class Be{constructor({dedupe:e=!1}={}){this.classRegistry=new ee,this.symbolRegistry=new Q(e=>e.description??""),this.customTransformerRegistry=new oe,this.allowedErrorProps=[],this.dedupe=e}serialize(e){const t=new Map,n=Ne(e,t,this,this.dedupe),r={json:n.transformedValue};n.annotations&&(r.meta={...r.meta,values:n.annotations});const i=function(e,t){const n={};let r;return e.forEach(e=>{if(e.length<=1)return;t||(e=e.map(e=>e.map(String)).sort((e,t)=>e.length-t.length));const[i,...o]=e;0===i.length?r=o.map(pe):n[pe(i)]=o.map(pe)}),r?le(n)?[r]:[r,n]:le(n)?void 0:n}(t,this.dedupe);return i&&(r.meta={...r.meta,referentialEqualities:i}),r}deserialize(e){const{json:t,meta:n}=e;let r=$e(t);return n?.values&&(r=xe(r,n.values,this)),n?.referentialEqualities&&(r=He(r,n.referentialEqualities)),r}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,t){this.classRegistry.register(e,t)}registerSymbol(e,t){this.symbolRegistry.register(e,t)}registerCustom(e,t){this.customTransformerRegistry.register({name:t,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}}Be.defaultInstance=new Be,Be.serialize=Be.defaultInstance.serialize.bind(Be.defaultInstance),Be.deserialize=Be.defaultInstance.deserialize.bind(Be.defaultInstance),Be.stringify=Be.defaultInstance.stringify.bind(Be.defaultInstance),Be.parse=Be.defaultInstance.parse.bind(Be.defaultInstance),Be.registerClass=Be.defaultInstance.registerClass.bind(Be.defaultInstance),Be.registerSymbol=Be.defaultInstance.registerSymbol.bind(Be.defaultInstance),Be.registerCustom=Be.defaultInstance.registerCustom.bind(Be.defaultInstance),Be.allowErrorProps=Be.defaultInstance.allowErrorProps.bind(Be.defaultInstance);const Ue=Be.serialize;var Fe,ze,We={},Ge={},qe={},Ve={};function Ke(){if(ze)return qe;ze=1;var e=function(){if(Fe)return Ve;Fe=1;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Ve.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},Ve.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1},Ve}();return qe.encode=function(t){var n,r="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(t);do{n=31&i,(i>>>=5)>0&&(n|=32),r+=e.encode(n)}while(i>0);return r},qe.decode=function(t,n,r){var i,o,s,a,l=t.length,c=0,u=0;do{if(n>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=e.decode(t.charCodeAt(n++))))throw new Error("Invalid base64 digit: "+t.charAt(n-1));i=!!(32&o),c+=(o&=31)<<u,u+=5}while(i);r.value=(a=(s=c)>>1,1&~s?a:-a),r.rest=n},qe}var Xe,Je={};function Ye(){return Xe||(Xe=1,function(e){e.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,n=/^data:.+\,.+$/;function r(e){var n=e.match(t);return n?{scheme:n[1],auth:n[2],host:n[3],port:n[4],path:n[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}e.urlParse=r,e.urlGenerate=i;var o,s,a=(o=function(t){var n=t,o=r(t);if(o){if(!o.path)return t;n=o.path}for(var s=e.isAbsolute(n),a=[],l=0,c=0;;){if(l=c,-1===(c=n.indexOf("/",l))){a.push(n.slice(l));break}for(a.push(n.slice(l,c));c<n.length&&"/"===n[c];)c++}var u,d=0;for(c=a.length-1;c>=0;c--)"."===(u=a[c])?a.splice(c,1):".."===u?d++:d>0&&(""===u?(a.splice(c+1,d),d=0):(a.splice(c,2),d--));return""===(n=a.join("/"))&&(n=s?"/":"."),o?(o.path=n,i(o)):n},s=[],function(e){for(var t=0;t<s.length;t++)if(s[t].input===e){var n=s[0];return s[0]=s[t],s[t]=n,s[0].result}var r=o(e);return s.unshift({input:e,result:r}),s.length>32&&s.pop(),r});function l(e,t){""===e&&(e="."),""===t&&(t=".");var o=r(t),s=r(e);if(s&&(e=s.path||"/"),o&&!o.scheme)return s&&(o.scheme=s.scheme),i(o);if(o||t.match(n))return t;if(s&&!s.host&&!s.path)return s.host=t,i(s);var l="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=l,i(s)):l}e.normalize=a,e.join=l,e.isAbsolute=function(e){return"/"===e.charAt(0)||t.test(e)},e.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var c=!("__proto__"in Object.create(null));function u(e){return e}function d(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function h(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}e.toSetString=c?u:function(e){return d(e)?"$"+e:e},e.fromSetString=c?u:function(e){return d(e)?e.slice(1):e},e.compareByOriginalPositions=function(e,t,n){var r=h(e.source,t.source);return 0!==r||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)||n||0!==(r=e.generatedColumn-t.generatedColumn)||0!==(r=e.generatedLine-t.generatedLine)?r:h(e.name,t.name)},e.compareByOriginalPositionsNoSource=function(e,t,n){var r;return 0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)||n||0!==(r=e.generatedColumn-t.generatedColumn)||0!==(r=e.generatedLine-t.generatedLine)?r:h(e.name,t.name)},e.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r||0!==(r=e.generatedColumn-t.generatedColumn)||n||0!==(r=h(e.source,t.source))||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)},e.compareByGeneratedPositionsDeflatedNoLine=function(e,t,n){var r=e.generatedColumn-t.generatedColumn;return 0!==r||n||0!==(r=h(e.source,t.source))||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)},e.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n||0!==(n=e.generatedColumn-t.generatedColumn)||0!==(n=h(e.source,t.source))||0!==(n=e.originalLine-t.originalLine)||0!==(n=e.originalColumn-t.originalColumn)?n:h(e.name,t.name)},e.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},e.computeSourceURL=function(e,t,n){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),n){var o=r(n);if(!o)throw new Error("sourceMapURL could not be parsed");if(o.path){var s=o.path.lastIndexOf("/");s>=0&&(o.path=o.path.substring(0,s+1))}t=l(i(o),t)}return a(t)}}(Je)),Je}var Ze,Qe={};function et(){if(Ze)return Qe;Ze=1;var e=Ye(),t=Object.prototype.hasOwnProperty,n="undefined"!=typeof Map;function r(){this._array=[],this._set=n?new Map:Object.create(null)}return r.fromArray=function(e,t){for(var n=new r,i=0,o=e.length;i<o;i++)n.add(e[i],t);return n},r.prototype.size=function(){return n?this._set.size:Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(r,i){var o=n?r:e.toSetString(r),s=n?this.has(r):t.call(this._set,o),a=this._array.length;s&&!i||this._array.push(r),s||(n?this._set.set(r,a):this._set[o]=a)},r.prototype.has=function(r){if(n)return this._set.has(r);var i=e.toSetString(r);return t.call(this._set,i)},r.prototype.indexOf=function(r){if(n){var i=this._set.get(r);if(i>=0)return i}else{var o=e.toSetString(r);if(t.call(this._set,o))return this._set[o]}throw new Error('"'+r+'" is not in the set.')},r.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},r.prototype.toArray=function(){return this._array.slice()},Qe.ArraySet=r,Qe}var tt,nt,rt={};function it(){if(tt)return rt;tt=1;var e=Ye();function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},t.prototype.add=function(t){var n,r,i,o,s,a;n=this._last,r=t,i=n.generatedLine,o=r.generatedLine,s=n.generatedColumn,a=r.generatedColumn,o>i||o==i&&a>=s||e.compareByGeneratedPositionsInflated(n,r)<=0?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},rt.MappingList=t,rt}function ot(){if(nt)return Ge;nt=1;var e=Ke(),t=Ye(),n=et().ArraySet,r=it().MappingList;function i(e){e||(e={}),this._file=t.getArg(e,"file",null),this._sourceRoot=t.getArg(e,"sourceRoot",null),this._skipValidation=t.getArg(e,"skipValidation",!1),this._ignoreInvalidMapping=t.getArg(e,"ignoreInvalidMapping",!1),this._sources=new n,this._names=new n,this._mappings=new r,this._sourcesContents=null}return i.prototype._version=3,i.fromSourceMap=function(e,n){var r=e.sourceRoot,o=new i(Object.assign(n||{},{file:e.file,sourceRoot:r}));return e.eachMapping(function(e){var n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=r&&(n.source=t.relative(r,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),o.addMapping(n)}),e.sources.forEach(function(n){var i=n;null!==r&&(i=t.relative(r,n)),o._sources.has(i)||o._sources.add(i);var s=e.sourceContentFor(n);null!=s&&o.setSourceContent(n,s)}),o},i.prototype.addMapping=function(e){var n=t.getArg(e,"generated"),r=t.getArg(e,"original",null),i=t.getArg(e,"source",null),o=t.getArg(e,"name",null);(this._skipValidation||!1!==this._validateMapping(n,r,i,o))&&(null!=i&&(i=String(i),this._sources.has(i)||this._sources.add(i)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:i,name:o}))},i.prototype.setSourceContent=function(e,n){var r=e;null!=this._sourceRoot&&(r=t.relative(this._sourceRoot,r)),null!=n?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(e,r,i){var o=r;if(null==r){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');o=e.file}var s=this._sourceRoot;null!=s&&(o=t.relative(s,o));var a=new n,l=new n;this._mappings.unsortedForEach(function(n){if(n.source===o&&null!=n.originalLine){var r=e.originalPositionFor({line:n.originalLine,column:n.originalColumn});null!=r.source&&(n.source=r.source,null!=i&&(n.source=t.join(i,n.source)),null!=s&&(n.source=t.relative(s,n.source)),n.originalLine=r.line,n.originalColumn=r.column,null!=r.name&&(n.name=r.name))}var c=n.source;null==c||a.has(c)||a.add(c);var u=n.name;null==u||l.has(u)||l.add(u)},this),this._sources=a,this._names=l,e.sources.forEach(function(n){var r=e.sourceContentFor(n);null!=r&&(null!=i&&(n=t.join(i,n)),null!=s&&(n=t.relative(s,n)),this.setSourceContent(n,r))},this)},i.prototype._validateMapping=function(e,t,n,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column){var i="original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.";if(this._ignoreInvalidMapping)return"undefined"!=typeof console&&console.warn&&console.warn(i),!1;throw new Error(i)}if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n)){i="Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r});if(this._ignoreInvalidMapping)return"undefined"!=typeof console&&console.warn&&console.warn(i),!1;throw new Error(i)}},i.prototype._serializeMappings=function(){for(var n,r,i,o,s=0,a=1,l=0,c=0,u=0,d=0,h="",g=this._mappings.toArray(),m=0,f=g.length;m<f;m++){if(n="",(r=g[m]).generatedLine!==a)for(s=0;r.generatedLine!==a;)n+=";",a++;else if(m>0){if(!t.compareByGeneratedPositionsInflated(r,g[m-1]))continue;n+=","}n+=e.encode(r.generatedColumn-s),s=r.generatedColumn,null!=r.source&&(o=this._sources.indexOf(r.source),n+=e.encode(o-d),d=o,n+=e.encode(r.originalLine-1-c),c=r.originalLine-1,n+=e.encode(r.originalColumn-l),l=r.originalColumn,null!=r.name&&(i=this._names.indexOf(r.name),n+=e.encode(i-u),u=i)),h+=n}return h},i.prototype._generateSourcesContent=function(e,n){return e.map(function(e){if(!this._sourcesContents)return null;null!=n&&(e=t.relative(n,e));var r=t.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null},this)},i.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},Ge.SourceMapGenerator=i,Ge}var st,at={},lt={};function ct(){return st||(st=1,function(e){function t(n,r,i,o,s,a){var l=Math.floor((r-n)/2)+n,c=s(i,o[l],!0);return 0===c?l:c>0?r-l>1?t(l,r,i,o,s,a):a==e.LEAST_UPPER_BOUND?r<o.length?r:-1:l:l-n>1?t(n,l,i,o,s,a):a==e.LEAST_UPPER_BOUND?l:n<0?-1:n}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(n,r,i,o){if(0===r.length)return-1;var s=t(-1,r.length,n,r,i,o||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===i(r[s],r[s-1],!0);)--s;return s}}(lt)),lt}var ut,dt,ht={};function gt(){if(ut)return ht;function e(e){function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}return function e(n,r,i,o){if(i<o){var s=i-1;t(n,(u=i,d=o,Math.round(u+Math.random()*(d-u))),o);for(var a=n[o],l=i;l<o;l++)r(n[l],a,!1)<=0&&t(n,s+=1,l);t(n,s+1,l);var c=s+1;e(n,r,i,c-1),e(n,r,c+1,o)}var u,d}}ut=1;let t=new WeakMap;return ht.quickSort=function(n,r,i=0){let o=t.get(r);void 0===o&&(o=function(t){let n=e.toString();return new Function(`return ${n}`)()(t)}(r),t.set(r,o)),o(n,r,i,n.length-1)},ht}var mt,ft,pt={};var yt=(ft||(ft=1,We.SourceMapGenerator=ot().SourceMapGenerator,We.SourceMapConsumer=function(){if(dt)return at;dt=1;var e=Ye(),t=ct(),n=et().ArraySet,r=Ke(),i=gt().quickSort;function o(t,n){var r=t;return"string"==typeof t&&(r=e.parseSourceMapInput(t)),null!=r.sections?new u(r,n):new s(r,n)}function s(t,r){var i=t;"string"==typeof t&&(i=e.parseSourceMapInput(t));var o=e.getArg(i,"version"),s=e.getArg(i,"sources"),a=e.getArg(i,"names",[]),l=e.getArg(i,"sourceRoot",null),c=e.getArg(i,"sourcesContent",null),u=e.getArg(i,"mappings"),d=e.getArg(i,"file",null);if(o!=this._version)throw new Error("Unsupported version: "+o);l&&(l=e.normalize(l)),s=s.map(String).map(e.normalize).map(function(t){return l&&e.isAbsolute(l)&&e.isAbsolute(t)?e.relative(l,t):t}),this._names=n.fromArray(a.map(String),!0),this._sources=n.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map(function(t){return e.computeSourceURL(l,t,r)}),this.sourceRoot=l,this.sourcesContent=c,this._mappings=u,this._sourceMapURL=r,this.file=d}function a(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}o.fromSourceMap=function(e,t){return s.fromSourceMap(e,t)},o.prototype._version=3,o.prototype.__generatedMappings=null,Object.defineProperty(o.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),o.prototype.__originalMappings=null,Object.defineProperty(o.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),o.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},o.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,o.prototype.eachMapping=function(t,n,r){var i,s=n||null;switch(r||o.GENERATED_ORDER){case o.GENERATED_ORDER:i=this._generatedMappings;break;case o.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}for(var a=this.sourceRoot,l=t.bind(s),c=this._names,u=this._sources,d=this._sourceMapURL,h=0,g=i.length;h<g;h++){var m=i[h],f=null===m.source?null:u.at(m.source);null!==f&&(f=e.computeSourceURL(a,f,d)),l({source:f,generatedLine:m.generatedLine,generatedColumn:m.generatedColumn,originalLine:m.originalLine,originalColumn:m.originalColumn,name:null===m.name?null:c.at(m.name)})}},o.prototype.allGeneratedPositionsFor=function(n){var r=e.getArg(n,"line"),i={source:e.getArg(n,"source"),originalLine:r,originalColumn:e.getArg(n,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var o=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,t.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===n.column)for(var l=a.originalLine;a&&a.originalLine===l;)o.push({line:e.getArg(a,"generatedLine",null),column:e.getArg(a,"generatedColumn",null),lastColumn:e.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var c=a.originalColumn;a&&a.originalLine===r&&a.originalColumn==c;)o.push({line:e.getArg(a,"generatedLine",null),column:e.getArg(a,"generatedColumn",null),lastColumn:e.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},at.SourceMapConsumer=o,s.prototype=Object.create(o.prototype),s.prototype.consumer=o,s.prototype._findSourceIndex=function(t){var n,r=t;if(null!=this.sourceRoot&&(r=e.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(n=0;n<this._absoluteSources.length;++n)if(this._absoluteSources[n]==t)return n;return-1},s.fromSourceMap=function(t,r){var o=Object.create(s.prototype),l=o._names=n.fromArray(t._names.toArray(),!0),c=o._sources=n.fromArray(t._sources.toArray(),!0);o.sourceRoot=t._sourceRoot,o.sourcesContent=t._generateSourcesContent(o._sources.toArray(),o.sourceRoot),o.file=t._file,o._sourceMapURL=r,o._absoluteSources=o._sources.toArray().map(function(t){return e.computeSourceURL(o.sourceRoot,t,r)});for(var u=t._mappings.toArray().slice(),d=o.__generatedMappings=[],h=o.__originalMappings=[],g=0,m=u.length;g<m;g++){var f=u[g],p=new a;p.generatedLine=f.generatedLine,p.generatedColumn=f.generatedColumn,f.source&&(p.source=c.indexOf(f.source),p.originalLine=f.originalLine,p.originalColumn=f.originalColumn,f.name&&(p.name=l.indexOf(f.name)),h.push(p)),d.push(p)}return i(o.__originalMappings,e.compareByOriginalPositions),o},s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});const l=e.compareByGeneratedPositionsDeflatedNoLine;function c(e,t){let n=e.length,r=e.length-t;if(!(r<=1))if(2==r){let n=e[t],r=e[t+1];l(n,r)>0&&(e[t]=r,e[t+1]=n)}else if(r<20)for(let i=t;i<n;i++)for(let n=i;n>t;n--){let t=e[n-1],r=e[n];if(l(t,r)<=0)break;e[n-1]=r,e[n]=t}else i(e,l,t)}function u(t,r){var i=t;"string"==typeof t&&(i=e.parseSourceMapInput(t));var s=e.getArg(i,"version"),a=e.getArg(i,"sections");if(s!=this._version)throw new Error("Unsupported version: "+s);this._sources=new n,this._names=new n;var l={line:-1,column:0};this._sections=a.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var n=e.getArg(t,"offset"),i=e.getArg(n,"line"),s=e.getArg(n,"column");if(i<l.line||i===l.line&&s<l.column)throw new Error("Section offsets must be ordered and non-overlapping.");return l=n,{generatedOffset:{generatedLine:i+1,generatedColumn:s+1},consumer:new o(e.getArg(t,"map"),r)}})}return s.prototype._parseMappings=function(t,n){var o,s,l,u,d=1,h=0,g=0,m=0,f=0,p=0,y=t.length,v=0,w={},E=[],b=[];let S=0;for(;v<y;)if(";"===t.charAt(v))d++,v++,h=0,c(b,S),S=b.length;else if(","===t.charAt(v))v++;else{for((o=new a).generatedLine=d,l=v;l<y&&!this._charIsMappingSeparator(t,l);l++);for(t.slice(v,l),s=[];v<l;)r.decode(t,v,w),u=w.value,v=w.rest,s.push(u);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");if(o.generatedColumn=h+s[0],h=o.generatedColumn,s.length>1&&(o.source=f+s[1],f+=s[1],o.originalLine=g+s[2],g=o.originalLine,o.originalLine+=1,o.originalColumn=m+s[3],m=o.originalColumn,s.length>4&&(o.name=p+s[4],p+=s[4])),b.push(o),"number"==typeof o.originalLine){let e=o.source;for(;E.length<=e;)E.push(null);null===E[e]&&(E[e]=[]),E[e].push(o)}}c(b,S),this.__generatedMappings=b;for(var C=0;C<E.length;C++)null!=E[C]&&i(E[C],e.compareByOriginalPositionsNoSource);this.__originalMappings=[].concat(...E)},s.prototype._findMapping=function(e,n,r,i,o,s){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return t.search(e,n,o,s)},s.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},s.prototype.originalPositionFor=function(t){var n={generatedLine:e.getArg(t,"line"),generatedColumn:e.getArg(t,"column")},r=this._findMapping(n,this._generatedMappings,"generatedLine","generatedColumn",e.compareByGeneratedPositionsDeflated,e.getArg(t,"bias",o.GREATEST_LOWER_BOUND));if(r>=0){var i=this._generatedMappings[r];if(i.generatedLine===n.generatedLine){var s=e.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),s=e.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var a=e.getArg(i,"name",null);return null!==a&&(a=this._names.at(a)),{source:s,line:e.getArg(i,"originalLine",null),column:e.getArg(i,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e})},s.prototype.sourceContentFor=function(t,n){if(!this.sourcesContent)return null;var r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];var i,o=t;if(null!=this.sourceRoot&&(o=e.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(i=e.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!i.path||"/"==i.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(n)return null;throw new Error('"'+o+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(t){var n=e.getArg(t,"source");if((n=this._findSourceIndex(n))<0)return{line:null,column:null,lastColumn:null};var r={source:n,originalLine:e.getArg(t,"line"),originalColumn:e.getArg(t,"column")},i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,e.getArg(t,"bias",o.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===r.source)return{line:e.getArg(s,"generatedLine",null),column:e.getArg(s,"generatedColumn",null),lastColumn:e.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},at.BasicSourceMapConsumer=s,u.prototype=Object.create(o.prototype),u.prototype.constructor=o,u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),u.prototype.originalPositionFor=function(n){var r={generatedLine:e.getArg(n,"line"),generatedColumn:e.getArg(n,"column")},i=t.search(r,this._sections,function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn}),o=this._sections[i];return o?o.consumer.originalPositionFor({line:r.generatedLine-(o.generatedOffset.generatedLine-1),column:r.generatedColumn-(o.generatedOffset.generatedLine===r.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:n.bias}):{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},u.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r||""===r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n];if(-1!==r.consumer._findSourceIndex(e.getArg(t,"source"))){var i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},u.prototype._parseMappings=function(t,n){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var o=this._sections[r],s=o.consumer._generatedMappings,a=0;a<s.length;a++){var l=s[a],c=o.consumer._sources.at(l.source);null!==c&&(c=e.computeSourceURL(o.consumer.sourceRoot,c,this._sourceMapURL)),this._sources.add(c),c=this._sources.indexOf(c);var u=null;l.name&&(u=o.consumer._names.at(l.name),this._names.add(u),u=this._names.indexOf(u));var d={source:c,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:u};this.__generatedMappings.push(d),"number"==typeof d.originalLine&&this.__originalMappings.push(d)}i(this.__generatedMappings,e.compareByGeneratedPositionsDeflated),i(this.__originalMappings,e.compareByOriginalPositions)},at.IndexedSourceMapConsumer=u,at}().SourceMapConsumer,We.SourceNode=function(){if(mt)return pt;mt=1;var e=ot().SourceMapGenerator,t=Ye(),n=/(\r?\n)/,r="$$$isSourceNode$$$";function i(e,t,n,i,o){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==o?null:o,this[r]=!0,null!=i&&this.add(i)}return i.fromStringWithSourceMap=function(e,r,o){var s=new i,a=e.split(n),l=0,c=function(){return e()+(e()||"");function e(){return l<a.length?a[l++]:void 0}},u=1,d=0,h=null;return r.eachMapping(function(e){if(null!==h){if(!(u<e.generatedLine)){var t=(n=a[l]||"").substr(0,e.generatedColumn-d);return a[l]=n.substr(e.generatedColumn-d),d=e.generatedColumn,g(h,t),void(h=e)}g(h,c()),u++,d=0}for(;u<e.generatedLine;)s.add(c()),u++;if(d<e.generatedColumn){var n=a[l]||"";s.add(n.substr(0,e.generatedColumn)),a[l]=n.substr(e.generatedColumn),d=e.generatedColumn}h=e},this),l<a.length&&(h&&g(h,c()),s.add(a.splice(l).join(""))),r.sources.forEach(function(e){var n=r.sourceContentFor(e);null!=n&&(null!=o&&(e=t.join(o,e)),s.setSourceContent(e,n))}),s;function g(e,n){if(null===e||void 0===e.source)s.add(n);else{var r=o?t.join(o,e.source):e.source;s.add(new i(e.originalLine,e.originalColumn,r,n,e.name))}}},i.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[r]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},i.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[r]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},i.prototype.walk=function(e){for(var t,n=0,i=this.children.length;n<i;n++)(t=this.children[n])[r]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},i.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},i.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[r]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},i.prototype.setSourceContent=function(e,n){this.sourceContents[t.toSetString(e)]=n},i.prototype.walkSourceContents=function(e){for(var n=0,i=this.children.length;n<i;n++)this.children[n][r]&&this.children[n].walkSourceContents(e);var o=Object.keys(this.sourceContents);for(n=0,i=o.length;n<i;n++)e(t.fromSetString(o[n]),this.sourceContents[o[n]])},i.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},i.prototype.toStringWithSourceMap=function(t){var n={code:"",line:1,column:0},r=new e(t),i=!1,o=null,s=null,a=null,l=null;return this.walk(function(e,t){n.code+=e,null!==t.source&&null!==t.line&&null!==t.column?(o===t.source&&s===t.line&&a===t.column&&l===t.name||r.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:n.line,column:n.column},name:t.name}),o=t.source,s=t.line,a=t.column,l=t.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),o=null,i=!1);for(var c=0,u=e.length;c<u;c++)10===e.charCodeAt(c)?(n.line++,n.column=0,c+1===u?(o=null,i=!1):i&&r.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:n.line,column:n.column},name:t.name})):n.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:n.code,map:r}},pt.SourceNode=i,pt}().SourceNode),We);class vt{static instance;sourceMapCache=new Map;pendingRequests=new Map;constructor(){}static getInstance(){return vt.instance||(vt.instance=new vt),vt.instance}async parseError(e){if(!e.stack)return[];try{const t=this.parseStackTrace(e.stack);return await Promise.all(t.map(async e=>{if(!e.fileName||!e.lineNumber||!e.columnNumber)return{originalLine:this.formatStackFrame(e)};const t=await this.getSourceMapConsumer(e.fileName);if(!t)return{originalLine:this.formatStackFrame(e)};const n=t.originalPositionFor({line:e.lineNumber,column:e.columnNumber});return n.source?{source:this.cleanSourcePath(n.source),line:n.line,column:n.column,name:n.name||e.functionName,originalLine:this.formatStackFrame(e)}:{originalLine:this.formatStackFrame(e)}}))}catch(t){return console.warn("Failed to parse error stack:",t),[]}}cleanSourcePath(e){return e.replace(/^(\.\.\/)+/,"")}parseStackTrace(e){const t=[],n=e.split("\n");for(const r of n){if(!r.trim().startsWith("at "))continue;const e=this.parseStackLine(r);e&&t.push(e)}return t}parseStackLine(e){const t=e.trim(),n=t.match(/at\s+(.+?)\s+\((.+):(\d+):(\d+)\)/);if(n)return{functionName:n[1],fileName:n[2],lineNumber:parseInt(n[3],10),columnNumber:parseInt(n[4],10)};const r=t.match(/at\s+(.+):(\d+):(\d+)/);return r?{fileName:r[1],lineNumber:parseInt(r[2],10),columnNumber:parseInt(r[3],10)}:null}formatStackFrame(e){const t=e.functionName||"<anonymous>",n=e.fileName||"<unknown>",r=e.lineNumber??"?",i=e.columnNumber??"?";return e.functionName?`at ${t} (${n}:${r}:${i})`:`at ${n}:${r}:${i}`}async getSourceMapConsumer(e){if(this.sourceMapCache.has(e))return this.sourceMapCache.get(e)??null;if(this.pendingRequests.has(e))return this.pendingRequests.get(e)??null;const t=this.fetchAndParseSourceMap(e);this.pendingRequests.set(e,t);try{const n=await t;return this.sourceMapCache.set(e,n),n}finally{this.pendingRequests.delete(e)}}async fetchAndParseSourceMap(e){try{const t=await this.getSourceMapUrl(e);if(!t)return null;const n=await fetch(t);if(!n.ok)return console.warn(`Failed to fetch source map: ${t}`),null;const r=await n.json();return await new yt.SourceMapConsumer(r)}catch(t){return console.warn(`Error parsing source map for ${e}:`,t),null}}async getSourceMapUrl(e){try{const t=`${e}.map`;if((await fetch(t,{method:"HEAD"})).ok)return t;const n=await fetch(e);if(!n.ok)return null;const r=(await n.text()).match(/\/\/# sourceMappingURL=(.+)$/m);if(r){const t=r[1].trim();if(t.startsWith("http://")||t.startsWith("https://"))return t;if(t.startsWith("data:"))return t;return`${e.substring(0,e.lastIndexOf("/"))}/${t}`}return null}catch(t){return console.warn(`Error getting source map URL for ${e}:`,t),null}}clearCache(){this.sourceMapCache.clear(),this.pendingRequests.clear()}}class wt{static CONSOLE_METHODS=["log","error","info","warn","dir","table"];originalMethods={};errorHandler=null;rejectionHandler=null;constructor(){this.init(),this.setupUnloadListener()}sendLog(t,n,r){try{e.sendEvent("add_new_log",{method:t,payload:Ue(n),timestamp:r})}catch(i){}}async resolveArgsStackTraces(e){const t=vt.getInstance();return Promise.all(e.map(async e=>{if(e instanceof Error&&e.stack)try{const n=await t.parseError(e),r=this.formatParsedStack(n,e.message);return{name:e.name,message:e.message,stack:r,...Object.fromEntries(Object.entries(e).filter(([e])=>!["name","message","stack"].includes(e)))}}catch{return e}return e}))}formatParsedStack(e,t){if(0===e.length)return"";const n=[];return t&&n.push(`Error: ${t}`),e.forEach(e=>{if(e.source&&void 0!==e.line&&void 0!==e.column){const t=e.name||"<anonymous>";n.push(`    at ${t} (${e.source}:${e.line}:${e.column})`)}else e.originalLine&&n.push(`    ${e.originalLine}`)}),n.join("\n")}init(){wt.CONSOLE_METHODS.forEach(e=>{const t=console[e];t&&(this.originalMethods[e]=t,console[e]=(...n)=>{const r=Date.now();t.apply(console,n),"error"===e?this.handleErrorLog(n,r):this.sendLog(e,n,r)})}),this.errorHandler=e=>{const t=Date.now();this.handleGlobalError(e,t)},window.addEventListener("error",this.errorHandler),this.rejectionHandler=e=>{const t=Date.now();this.handlePromiseRejection(e,t)},window.addEventListener("unhandledrejection",this.rejectionHandler)}async handleErrorLog(e,t){try{const n=await this.resolveArgsStackTraces(e);this.sendLog("error",n,t)}catch{this.sendLog("error",e,t)}}async handleGlobalError(e,t){if(e.error instanceof Error)try{const n=vt.getInstance(),r=await n.parseError(e.error),i=this.formatParsedStack(r,e.error.message);return void this.sendLog("error",["[Global Error]",e.message,e.filename,`Line: ${e.lineno}, Column: ${e.colno}`,i?`\nStack:\n${i}`:""],t)}catch{}this.sendLog("error",["[Global Error]",e.message,e.filename,`Line: ${e.lineno}, Column: ${e.colno}`,e.error?.stack?`\nStack:\n${e.error.stack}`:""],t)}async handlePromiseRejection(e,t){const n=e.reason;if(n instanceof Error)try{const e=vt.getInstance(),r=await e.parseError(n),i=this.formatParsedStack(r,n.message);return void this.sendLog("error",["[Promise Rejection]",n.message,`\nStack:\n${i}`],t)}catch{}n instanceof Error?this.sendLog("error",["[Promise Rejection]",n.message,n.stack?`\nStack:\n${n.stack}`:""],t):this.sendLog("error",["[Promise Rejection]",String(n)],t)}setupUnloadListener(){window.addEventListener("beforeunload",()=>{this.destroy()})}destroy(){wt.CONSOLE_METHODS.forEach(e=>{this.originalMethods[e]&&(console[e]=this.originalMethods[e],delete this.originalMethods[e])}),this.errorHandler&&(window.removeEventListener("error",this.errorHandler),this.errorHandler=null),this.rejectionHandler&&(window.removeEventListener("unhandledrejection",this.rejectionHandler),this.rejectionHandler=null)}}new wt,Object.defineProperty(document,"domain",{value:document.domain,writable:!1,configurable:!1});const Et=Object.getOwnPropertyDescriptor(Document.prototype,"cookie"),bt=["_ga","_gcl_au","client_id","yw_id","sidebar_expanded","_ga_6Z2G4L6M8E","install_flag","cf_clearance","passcode-session","session_v2","staging_session_v2","x-yw-access"];async function St(e){return new Promise((t,n)=>{const r=new FileReader;r.onloadend=()=>{const e=r.result.split(",")[1];t(e)},r.onerror=n,r.readAsDataURL(e)})}function Ct(e){let t;t=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const n=String.fromCharCode.apply(null,Array.from(t));return btoa(n)}Object.defineProperty(document,"cookie",{get:function(){const e=Et?.get?.call(this);return(t=e)?t.split(";").map(e=>e.trim()).filter(e=>{const t=e.split("=")[0].trim();return!bt.includes(t)}).join("; "):t;var t},set:function(e){const t=function(e){const t=e.split(";").map(e=>e.trim()).filter(e=>!e.toLowerCase().startsWith("domain="));return t.push(`domain=${location.hostname}`),t.join("; ")}(e);return Et?.set?.call(this,t)},configurable:!1});const Mt={chunkSize:16384,highWaterMark:65536};let _t=null;const Lt=window.fetch;let kt={urlPatterns:[],messageManager:null};const Rt=new Map;function Tt(e){const t=[];if(!e)return{entries:t};if(e instanceof Headers)e.forEach((e,n)=>{t.push([n,e])});else if(Array.isArray(e))t.push(...e);else for(const[n,r]of Object.entries(e))t.push([n,String(r)]);return{entries:t}}async function At(e,t){let n,r,i=null;if(e instanceof Request?(r=e,n=r.url,i=e.body,t&&("body"in t&&(i=t.body),r=new Request(r,t))):(n=e instanceof URL?e.toString():e,i=t?.body,r=new Request(n,t)),!function(e){return kt.urlPatterns.some(t=>e.includes(t))}(n))return Lt(e,t);const o=`${Date.now()}-${Math.random().toString(36).substring(2,9)}`;try{const e=new AbortController;Rt.set(o,e),r.signal&&r.signal.addEventListener("abort",()=>{e.abort(),_t.sendEvent("fetch-proxy:stream-control",{requestId:o,action:"abort"})});const t=await async function(e){if(null==e)return{type:"null",data:null};if("string"==typeof e)try{return JSON.parse(e),{type:"json",data:e}}catch{return{type:"string",data:e}}if(e instanceof URLSearchParams)return{type:"urlsearchparams",data:e.toString()};if(e instanceof FormData){const t=[],n=[];return e.forEach((e,r)=>{if(e instanceof File){const i=St(e).then(n=>{t.push([r,{name:e.name,type:e.type,size:e.size,lastModified:e.lastModified,content:n}])});n.push(i)}else t.push([r,e])}),await Promise.all(n),{type:"formdata",data:t}}if(e instanceof Blob){const t=await St(e);return{type:"blob",data:{type:e.type,size:e.size,content:t}}}if(e instanceof ArrayBuffer)return{type:"arraybuffer",data:Ct(e)};if(ArrayBuffer.isView(e))return{type:"arraybuffer",data:Ct(e)};if(e instanceof ReadableStream){const t=new Response(e),n=await t.blob();return{type:"stream",data:await St(n)}}throw new Error(`Unsupported body type: ${Object.prototype.toString.call(e)}`)}(i),a={requestId:o,url:n,method:r.method,headers:Tt(r.headers),body:t,credentials:r.credentials,mode:r.mode,cache:r.cache,redirect:r.redirect,referrer:r.referrer,referrerPolicy:r.referrerPolicy,integrity:r.integrity,keepalive:r.keepalive,signal:r.signal?{aborted:r.signal.aborted}:void 0};if(!_t)throw new Error("Fetch proxy not initialized. Call initializeFetchInterceptor with messageManager first.");const l=await _t.invoke("fetch-proxy:fetch",a),c=(s=l.headers,new Headers(s.entries)),u=function(e,t={},n,r){const i={...Mt,...t};let o=0,s=!1,a=null,l=null;return new ReadableStream({async start(t){a=t;const i=n.onEvent("fetch-proxy:stream-control",t=>{if(t.requestId===e)switch(t.action){case"end":!s&&a&&(a.close(),s=!0,l?.());break;case"error":!s&&a&&(a.error(new Error(t.error||"Stream error")),s=!0,l?.());break;case"abort":!s&&a&&(a.error(new DOMException("Stream aborted","AbortError")),s=!0,l?.())}}),o=()=>{!s&&a&&(a.error(new DOMException("Stream aborted","AbortError")),s=!0,l?.())};r&&r.addEventListener("abort",o),l=()=>{i(),r&&r.removeEventListener("abort",o)}},async pull(t){if(!s)try{const r=await n.invoke("fetch-proxy:stream-read",{requestId:e,chunkIndex:o});if(r.done)s||(t.close(),s=!0,l?.());else{const e=new Uint8Array(r.chunk);t.enqueue(e),o++}}catch(r){console.error("[Stream Proxy] Error in pull:",r),s||(t.error(r),s=!0,l?.())}},cancel(t){s=!0,n.sendEvent("fetch-proxy:stream-control",{requestId:e,action:"abort",error:t?.toString()}),l?.()}},{highWaterMark:i.highWaterMark,size:e=>e.byteLength})}(o,{},_t,e.signal),d=new Response(u,{status:l.status,statusText:l.statusText,headers:c});return Object.defineProperties(d,{url:{value:l.url,writable:!1},redirected:{value:l.redirected,writable:!1},type:{value:l.type,writable:!1},ok:{value:l.ok,writable:!1}}),d}catch(a){throw Rt.delete(o),a}var s}function Ot(e){if(!e.messageManager)throw new Error("messageManager is required in config");if(!e.urlPatterns)throw new Error("urlPatterns is required in config");var t;t=e,kt={...kt,...t},t.messageManager&&(_t=t.messageManager),t.urlPatterns&&(kt.urlPatterns=t.urlPatterns),window.fetch=At,"undefined"!=typeof globalThis&&(globalThis.fetch=At)}!function(){try{Ot({urlPatterns:["api.youware.com/public/v1/ai/","backend.youware.com"],messageManager:e})}catch(t){console.error("Failed to initialize fetch interceptor:",t)}}();const Pt={innerRequest:function(t,n){if(!t)throw new Error("[ywSdk] innerRequest apiName parameter cannot be null or undefined");return e.invoke("innerRequest",{apiName:t,params:n})},getLoginStatus:async function(){return e.invoke("getLoginStatus",void 0)},requestLogin:async function(t){return e.invoke("requestLogin",t)}};function It(e){if("string"==typeof e&&e.includes("${"))return t=e,function(e){return t.replace(/\${(\w+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})};if("object"==typeof e&&null!==e){const t=Array.isArray(e)?[]:{};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=It(e[n]));return t}var t;return e}function xt(e){return null===e||"object"!=typeof e?e:(Object.keys(e).forEach(t=>{null!==e[t]&&"object"==typeof e[t]&&xt(e[t])}),Object.freeze(e))}Object.defineProperty(window,"ywSdk",{value:Pt,writable:!1,configurable:!1}),async function(){const e=document.getElementById("yw-manifest-data");if(!e)return;const t=e.textContent||"";let n;try{n=JSON.parse(t)}catch(r){console.error("Error parsing yw_manifest.json (inside yw-manifest-data script block) failed:",r);try{const e=await fetch("/yw_manifest.json");n=await e.json()}catch(i){return void console.error("Error parsing yw_manifest.json (fetch from /yw_manifest.json) failed:",i)}}try{const e=xt(It(n));Object.defineProperty(window,"ywConfig",{value:e,writable:!1,configurable:!1})}catch(r){console.error("Error processing ywConfig:",r)}}();new class{isInitialized=!1;routerList=["/"];originalPushState=null;originalReplaceState=null;constructor(){this.isInitialized||(this.isInitialized=!0,this.interceptHistoryMethods(),setTimeout(()=>this.handleRouteChange(),100),"complete"===document.readyState?this.discoverAndSendRoutes():window.addEventListener("load",()=>{setTimeout(()=>{this.discoverAndSendRoutes()},500)}),e.onEvent("route_redirect",e=>{window.history.pushState({},"",e.path),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}),window.addEventListener("beforeunload",()=>{this.cleanup()}))}interceptHistoryMethods(){this.originalPushState||(this.originalPushState=window.history.pushState),this.originalReplaceState||(this.originalReplaceState=window.history.replaceState),window.history.pushState=(...e)=>{this.originalPushState.apply(window.history,e),setTimeout(()=>this.handleRouteChange(),0)},window.history.replaceState=(...e)=>{this.originalReplaceState.apply(window.history,e),setTimeout(()=>this.handleRouteChange(),0)},window.addEventListener("popstate",this.handleRouteChange)}handleRouteChange=()=>{const t=window.location.pathname||"/";e.sendEvent("route_changed",{pathname:t})};discoverAndSendRoutes(){try{const t=[...document.querySelectorAll('a[href^="/"]')].map(e=>e.getAttribute("href")).filter(e=>null!==e).map(e=>e.split("?")[0].split("#")[0]);this.routerList=[...new Set([...this.routerList,...t])],e.sendEvent("routes_discovered",{routes:this.routerList})}catch(t){console.error("Route discovery failed:",t)}}cleanup(){this.originalPushState&&(window.history.pushState=this.originalPushState),this.originalReplaceState&&(window.history.replaceState=this.originalReplaceState),window.removeEventListener("popstate",this.handleRouteChange),this.isInitialized=!1}};class Ht{constructor(e,t,n){this.emitConsole=e,this.emitError=t,this.name="console",this.originalMethods={},this.maskPatterns=[...n?.maskConsolePatterns||[]]}start(){this.interceptConsole(),this.interceptErrors()}stop(){this.restoreConsole(),this.restoreErrorHandlers()}getTime(){return Math.round(performance.now())}interceptConsole(){["log","info","warn","error","debug"].forEach(e=>{this.originalMethods[e]=console[e],console[e]=(...t)=>{let n;if("error"===e){const e=new Error;if(e.stack){n=e.stack.split("\n").slice(2).join("\n")}}this.originalMethods[e]?.apply(console,t),"error"===e?this.handleErrorLog(t,n):this.handleConsoleCall(e,t)}})}async resolveArgsStackTraces(e){const t=vt.getInstance();return Promise.all(e.map(async e=>{if(e instanceof Error&&e.stack)try{const n=await t.parseError(e),r=this.formatParsedStack(n,e.message);return{name:e.name,message:e.message,stack:r,...Object.fromEntries(Object.entries(e).filter(([e])=>!["name","message","stack"].includes(e)))}}catch{return e}return e}))}formatParsedStack(e,t){if(0===e.length)return"";const n=[];return t&&n.push(`Error: ${t}`),e.forEach(e=>{if(e.source&&void 0!==e.line&&void 0!==e.column){const t=e.name||"<anonymous>";n.push(`    at ${t} (${e.source}:${e.line}:${e.column})`)}else e.originalLine&&n.push(`    ${e.originalLine}`)}),n.join("\n")}async handleErrorLog(e,t){const n=this.getTime();try{const r=await this.resolveArgsStackTraces(e),i=r.map(e=>this.serializeArg(e)).map(e=>"string"==typeof e?this.maskSensitiveContent(e):e);let o;if(t)try{const e=new Error;e.stack=t;const n=vt.getInstance(),r=await n.parseError(e);o=this.formatParsedStack(r)}catch{o=t}this.emitConsole({t:n,level:"error",args:i,callStack:o})}catch{this.handleConsoleCall("error",e)}}handleConsoleCall(e,t){const n=this.getTime();try{const r=t.map(e=>this.serializeArg(e)).map(e=>"string"==typeof e?this.maskSensitiveContent(e):e);this.emitConsole({t:n,level:e,args:r})}catch{}}restoreConsole(){["log","info","warn","error","debug"].forEach(e=>{this.originalMethods[e]&&(console[e]=this.originalMethods[e])})}interceptErrors(){const e=async e=>{const t=this.getTime();if(e.error instanceof Error)try{const n=vt.getInstance(),r=await n.parseError(e.error),i=this.formatParsedStack(r,e.error.message);return void this.emitError({t:t,type:"runtime",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:i})}catch{}this.emitError({t:t,type:"runtime",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?.stack})};this.errorHandler=e,window.addEventListener("error",e),this.rejectionHandler=async e=>{const t=this.getTime(),n=e.reason;if(n instanceof Error)try{const e=vt.getInstance(),r=await e.parseError(n),i=this.formatParsedStack(r,n.message);return void this.emitError({t:t,type:"unhandledrejection",message:n.message,stack:i})}catch{}n instanceof Error?this.emitError({t:t,type:"unhandledrejection",message:n.message,stack:n.stack}):this.emitError({t:t,type:"unhandledrejection",message:String(n)})},window.addEventListener("unhandledrejection",this.rejectionHandler)}restoreErrorHandlers(){this.errorHandler&&window.removeEventListener("error",this.errorHandler),this.rejectionHandler&&window.removeEventListener("unhandledrejection",this.rejectionHandler)}serializeArg(e){try{return null===e?"null":void 0===e?"undefined":"string"==typeof e||"number"==typeof e||"boolean"==typeof e?e:"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:e instanceof Error?`${e.name}: ${e.message}`:"object"==typeof e?JSON.parse(JSON.stringify(e,this.getCircularReplacer())):String(e)}catch{return"[Unserializable]"}}getCircularReplacer(){const e=new WeakSet;return(t,n)=>{if("object"==typeof n&&null!==n){if(e.has(n))return"[Circular]";e.add(n)}return n}}maskSensitiveContent(e){if(0===this.maskPatterns.length)return e;let t=e;for(const n of this.maskPatterns)try{const e=new RegExp(`(${n}[:\\s=]+)([^\\s,;]+)`,"gi");t=t.replace(e,"$1[MASKED]")}catch{if(t.toLowerCase().includes(n.toLowerCase())){t="[MASKED: contains sensitive data]";break}}return t}}const Nt=globalThis.Buffer,jt="undefined"!=typeof TextDecoder?new TextDecoder:void 0,Dt=new Map;function $t(e){if(!e)return null;if(e.includes(":"))return null;if(Dt.has(e))return Dt.get(e)??null;try{const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4),r=function(e){if("function"==typeof atob){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);if(jt)return jt.decode(n);let r="";for(let e=0;e<n.length;e++)r+=String.fromCharCode(n[e]);return r}if(Nt)return Nt.from(e,"base64").toString("utf8");throw new Error("No base64 decoder available")}(t+n),i=r.lastIndexOf("@");if(i<=0||i===r.length-1)return Dt.set(e,null),null;const o=r.slice(0,i),s=r.slice(i+1),a=s.indexOf(":");if(a<=0||a===s.length-1)return Dt.set(e,null),null;const l=Number.parseInt(s.slice(0,a),10),c=Number.parseInt(s.slice(a+1),10);if(Number.isNaN(l)||Number.isNaN(c))return Dt.set(e,null),null;const u={relativePath:o,line:l,column:c};return Dt.set(e,u),u}catch(t){return console.warn("[Recorder] Failed to decode data-yw attribute",{value:e,error:t}),Dt.set(e,null),null}}const Bt=["name","type","role","aria-label","data-testid","href","src","alt","placeholder"];function Ut(e){const t=[];let n=e;for(;n&&n!==document.documentElement;){let e=n.tagName.toLowerCase();if(n.id){e=`${e}[@id="${n.id}"]`,t.unshift(e);break}const r=n.parentElement;if(r){const t=Array.from(r.children).filter(e=>e.tagName===n.tagName);if(t.length>1){e=`${e}[${t.indexOf(n)+1}]`}}t.unshift(e),n=n.parentElement}return"/"+t.join("/")}function Ft(e){let t="";const n=e.childNodes;for(let r=0;r<n.length;r++){const e=n[r];e.nodeType===Node.TEXT_NODE&&(t+=e.textContent?.trim()||"")}return t.trim()}function zt(e,t){return e.length<=t?e:e.slice(0,t)+"..."}function Wt(e){const t={xpath:Ut(e),tag:e.tagName.toLowerCase()};e.id&&(t.id=e.id),e.classList&&e.classList.length>0&&(t.class=Array.from(e.classList).join(" "));const n=function(e){const t={};for(const n of Bt){const r=e.getAttribute(n);if(r)if("href"===n||"src"===n)try{const e=new URL(r,window.location.href);t[n]=zt(e.pathname+e.search,100)}catch{t[n]=zt(r,50)}else t[n]=zt(r,50)}return Object.keys(t).length>0?t:void 0}(e);n&&(t.attrs=n);const r=Ft(e);r&&(t.text=zt(r,50)),t.html=function(e){const t=e.tagName.toLowerCase(),n=[];e.id&&n.push(`id="${e.id}"`);const r=n.length>0?" "+n.join(" "):"",i=e.children.length,o=zt(Ft(e),30);let s="";return o?s=o:i>0&&(s=`[${i} children]`),zt(`<${t}${r}>${s}</${t}>`,500)}(e);const i=e.getBoundingClientRect();t.rect={x:Math.round(i.x),y:Math.round(i.y),w:Math.round(i.width),h:Math.round(i.height)};const o=function(e){if(0===e.children.length)return;const t={},n=e.children;for(let i=0;i<n.length;i++){const e=n[i].tagName.toLowerCase();t[e]=(t[e]||0)+1}const r=Object.entries(t).sort((e,t)=>t[1]-e[1]).slice(0,5);return{count:e.children.length,tags:Object.fromEntries(r)}}(e);o&&(t.children=o);const s=function(e){const t=e.getAttribute("data-source");if(t&&t.includes(":"))return t;const n=e.getAttribute("data-yw");if(n){const e=$t(n);if(e)return`${e.relativePath}:${e.line}:${e.column}`}}(e);return s&&(t.source=s),t}const Gt=["password","passwd","pwd","secret","token","api_key","apikey","api-key","credit","card","ssn","social","cvv","cvc","pin"];function qt(e,t){if(e instanceof HTMLInputElement&&"password"===e.type)return!0;const n=e.name?.toLowerCase()||"",r=e.id?.toLowerCase()||"",i=e.getAttribute("placeholder")?.toLowerCase()||"",o=e.getAttribute("aria-label")?.toLowerCase()||"",s=t?[...Gt,...t.map(e=>e.toLowerCase())]:Gt,a=[n,r,i,o];return s.some(e=>a.some(t=>t.includes(e)))}function Vt(e,t){return!(!t||0===t.length)&&t.some(t=>{try{return e.matches(t)||null!==e.closest(t)}catch{return!1}})}function Kt(e){return e instanceof HTMLInputElement&&("checkbox"===e.type||"radio"===e.type)?e.checked?"checked":"unchecked":e.value}class Xt{constructor(e,t){this.emit=e,this.redactConfig=t,this.name="form"}start(){this.submitHandler=e=>{const t=e.target;t&&t instanceof HTMLFormElement&&this.emit({t:this.getTime(),action:"submit",target:Wt(t),value:this.getFormSummary(t)})},document.addEventListener("submit",this.submitHandler,!0)}stop(){this.submitHandler&&document.removeEventListener("submit",this.submitHandler,!0)}getTime(){return Math.round(performance.now())}getFormSummary(e){const t=[],n=e.elements;for(let i=0;i<n.length;i++){const e=n[i];if(e instanceof HTMLButtonElement||e instanceof HTMLInputElement&&("submit"===e.type||"button"===e.type||"hidden"===e.type))continue;const r=e.name||e.id||`field_${i}`,o=this.shouldMaskField(e,r)?"[MASKED]":Kt(e).slice(0,30);t.push(`${r}=${o}`)}const r=t.join(", ");return r.length>200?r.slice(0,200)+"...":r}shouldMaskField(e,t){if(qt(e))return!0;if(this.redactConfig?.maskFormFields){const e=t.toLowerCase();return this.redactConfig.maskFormFields.some(t=>e.includes(t.toLowerCase()))}return!1}}class Jt{constructor(){this.timers=new Map}debounce(e,t,n){const r=this.timers.get(e);r&&clearTimeout(r);const i=setTimeout(()=>{this.timers.delete(e),n()},t);this.timers.set(e,i)}clear(){this.timers.forEach(e=>clearTimeout(e)),this.timers.clear()}cancel(e){const t=this.timers.get(e);t&&(clearTimeout(t),this.timers.delete(e))}}const Yt={scroll:150,input:300};class Zt{constructor(e,t,n){this.emit=e,this.name="interaction",this.debounceManager=new Jt,this.handlers=new Map,this.debounceConfig={...Yt,...t},this.redactConfig=n}start(){this.bindEvents()}stop(){this.unbindEvents(),this.debounceManager.clear()}getTime(){return Math.round(performance.now())}bindEvents(){this.addHandler("click",this.handleClick),this.addHandler("dblclick",this.handleClick),this.addHandler("contextmenu",this.handleClick),this.addHandler("scroll",this.handleScroll),this.addHandler("input",this.handleInput),this.addHandler("change",this.handleChange),this.addHandler("focus",this.handleFocus),this.addHandler("blur",this.handleBlur),this.addHandler("keydown",this.handleKeydown),this.addHandler("copy",this.handleCopy),this.addHandler("paste",this.handlePaste)}unbindEvents(){this.handlers.forEach((e,t)=>{document.removeEventListener(t,e,!0)}),this.handlers.clear()}addHandler(e,t){const n=t.bind(this);this.handlers.set(e,n),document.addEventListener(e,n,!0)}handleClick(e){const t=e,n=t.target;if(!(n&&n instanceof Element))return;if(Vt(n,this.redactConfig?.ignoreSelectors))return;const r=Wt(n);var i,o;i=n,o=this.redactConfig?.maskTextSelectors,o&&0!==o.length&&o.some(e=>{try{return i.matches(e)||null!==i.closest(e)}catch{return!1}})&&(r.text="[MASKED]",r.html=r.html?.replace(/>.*</,">[MASKED]<")),this.emit({t:this.getTime(),type:t.type,target:r,data:{button:t.button,x:Math.round(t.clientX),y:Math.round(t.clientY)}})}handleScroll(e){const t=e.target;t&&this.debounceManager.debounce("scroll",this.debounceConfig.scroll,()=>{const e=t===document?document.documentElement:t,n=t instanceof Element?t:document.documentElement,r=n.tagName.toLowerCase(),i="html"===r||"body"===r?{xpath:Ut(o=n),tag:o.tagName.toLowerCase()}:Wt(n);var o;this.emit({t:this.getTime(),type:"scroll",target:i,data:{scrollX:Math.round(e.scrollLeft||window.scrollX),scrollY:Math.round(e.scrollTop||window.scrollY)}})})}handleInput(e){const t=e.target;if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return;if(Vt(t,this.redactConfig?.ignoreSelectors))return;const n=`input_${Ut(t)}`;this.debounceManager.debounce(n,this.debounceConfig.input,()=>{let e;e=this.redactConfig?.maskAllInputValues?"[INPUT]":qt(t,this.redactConfig?.sensitiveFieldPatterns)?"[MASKED]":t.value.slice(0,100),this.emit({t:this.getTime(),type:"input",target:Wt(t),data:{value:e}})})}handleChange(e){const t=e.target;if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement))return;if(Vt(t,this.redactConfig?.ignoreSelectors))return;let n;n=this.redactConfig?.maskAllInputValues?"[CHANGED]":qt(t,this.redactConfig?.sensitiveFieldPatterns)?"[MASKED]":Kt(t).slice(0,100),this.emit({t:this.getTime(),type:"change",target:Wt(t),data:{value:n}})}handleFocus(e){const t=e.target;t&&t instanceof Element&&(Vt(t,this.redactConfig?.ignoreSelectors)||this.emit({t:this.getTime(),type:"focus",target:Wt(t)}))}handleBlur(e){const t=e.target;t&&t instanceof Element&&(Vt(t,this.redactConfig?.ignoreSelectors)||this.emit({t:this.getTime(),type:"blur",target:Wt(t)}))}handleKeydown(e){const t=e,n=t.key.length>1,r=t.ctrlKey||t.metaKey||t.altKey;if(!n&&!r)return;const i=t.target;i&&i instanceof Element&&this.emit({t:this.getTime(),type:"keydown",target:Wt(i),data:{key:t.key,code:t.code}})}handleCopy(e){const t=e.target;if(!(t&&t instanceof Element))return;if(Vt(t,this.redactConfig?.ignoreSelectors))return;const n=this.redactConfig?.maskAllInputValues?void 0:window.getSelection()?.toString();this.emit({t:this.getTime(),type:"copy",target:Wt(t),data:n?{selection:n.slice(0,100)}:void 0})}handlePaste(e){const t=e.target;t&&t instanceof Element&&this.emit({t:this.getTime(),type:"paste",target:Wt(t)})}}class Qt{constructor(e){this.emit=e,this.name="navigation",this.originalPushState=history.pushState.bind(history),this.originalReplaceState=history.replaceState.bind(history),this.currentPath=this.getRelativePath(window.location.href)}getRelativePath(e){try{const t=new URL(e,window.location.origin);return t.pathname+t.search+t.hash}catch{const t=e.match(/^(?:https?:\/\/[^/]+)?(.*)$/);return t?t[1]||"/":e}}start(){this.interceptHistoryMethods(),this.bindEventListeners()}stop(){this.restoreHistoryMethods(),this.unbindEventListeners()}getTime(){return Math.round(performance.now())}interceptHistoryMethods(){const e=this;history.pushState=function(t,n,r){const i=e.currentPath;e.originalPushState(t,n,r);const o=e.getRelativePath(window.location.href);e.currentPath=o,i!==o&&e.emit({t:e.getTime(),type:"pushState",from:i,to:o})},history.replaceState=function(t,n,r){const i=e.currentPath;e.originalReplaceState(t,n,r);const o=e.getRelativePath(window.location.href);e.currentPath=o,i!==o&&e.emit({t:e.getTime(),type:"replaceState",from:i,to:o})}}restoreHistoryMethods(){history.pushState=this.originalPushState,history.replaceState=this.originalReplaceState}bindEventListeners(){this.popstateHandler=()=>{const e=this.currentPath,t=this.getRelativePath(window.location.href);this.currentPath=t,e!==t&&this.emit({t:this.getTime(),type:"popstate",from:e,to:t})},this.hashchangeHandler=e=>{const t=this.getRelativePath(e.oldURL),n=this.getRelativePath(e.newURL);this.currentPath=n,t!==n&&this.emit({t:this.getTime(),type:"hashchange",from:t,to:n})},window.addEventListener("popstate",this.popstateHandler),window.addEventListener("hashchange",this.hashchangeHandler)}unbindEventListeners(){this.popstateHandler&&window.removeEventListener("popstate",this.popstateHandler),this.hashchangeHandler&&window.removeEventListener("hashchange",this.hashchangeHandler)}}function en(e){if(!e)return e;try{const t=new URL(e,window.location.href),n=window.location;return t.origin===n.origin?t.pathname+t.search+t.hash:t.href}catch{return e}}const tn=["application/json","text/plain","text/html","text/xml","application/xml","application/x-www-form-urlencoded"];class nn{constructor(e,t,n){this.emit=e,this.redactConfig=t,this.name="network",this.requestIdCounter=0,this.originalFetch=window.fetch,this.originalXHR=window.XMLHttpRequest,this.maxBodySize=n?.maxBodySize??1e4,this.captureRequestBody=n?.captureRequestBody??!0,this.captureResponseBody=n?.captureResponseBody??!0}start(){this.interceptFetch(),this.interceptXHR()}stop(){window.fetch=this.originalFetch,window.XMLHttpRequest=this.originalXHR}getTime(){return Math.round(performance.now())}interceptFetch(){const e=this;window.fetch=function(...t){const n="fetch_"+e.requestIdCounter++;let r;r="string"==typeof t[0]?t[0]:t[0]instanceof URL?t[0].href:t[0].url;const i=t[1]||{},o=(i.method||"GET").toUpperCase(),s=performance.now();if(e.shouldIgnoreUrl(r))return e.originalFetch.apply(this,t);const a=e.captureRequestBody?e.extractRequestBody(i.body):void 0;return e.emit({t:e.getTime(),id:n,method:o,url:e.processUrl(r),request:{headers:e.redactHeaders(e.getHeaders(i.headers)),body:a}}),e.originalFetch.apply(this,t).then(async t=>{const i=Math.round(performance.now()-s),a=t.headers.get("content-type")||"";let l,c=!1;if(e.captureResponseBody&&e.isTextContentType(a))try{const n=t.clone(),r=await n.text();r.length>e.maxBodySize?(l=r.slice(0,e.maxBodySize),c=!0):l=r}catch{l="[Failed to read response body]"}return e.emit({t:e.getTime(),id:n,method:o,url:e.processUrl(r),response:{status:t.status,statusText:t.statusText,headers:e.redactHeaders(e.getResponseHeaders(t)),duration:i,contentType:a||void 0,body:l,truncated:c||void 0}}),t},t=>{const i=Math.round(performance.now()-s);throw e.emit({t:e.getTime(),id:n,method:o,url:e.processUrl(r),error:{message:t.message},response:{status:0,statusText:"Network Error",duration:i}}),t})}}interceptXHR(){const e=this,t=this.originalXHR;window.XMLHttpRequest=function(){const n=new t,r="xhr_"+e.requestIdCounter++;let i,o="",s="",a=0;const l=n.open,c=n.send;return n.open=function(e,t,...n){return o=e.toUpperCase(),s=t.toString(),l.apply(this,[e,t,...n])},n.send=function(t){return a=performance.now(),e.captureRequestBody&&t&&(i=e.extractRequestBody(t)),e.shouldIgnoreUrl(s)||e.emit({t:e.getTime(),id:r,method:o,url:e.processUrl(s),request:{body:i}}),c.call(this,t)},n.addEventListener("loadend",function(){if(e.shouldIgnoreUrl(s))return;const t=Math.round(performance.now()-a),i=n.getResponseHeader("content-type")||"";let l,c=!1;if(e.captureResponseBody&&0!==n.status&&e.isTextContentType(i))try{const t=n.responseText;t.length>e.maxBodySize?(l=t.slice(0,e.maxBodySize),c=!0):l=t}catch{l="[Failed to read response body]"}0===n.status?e.emit({t:e.getTime(),id:r,method:o,url:e.processUrl(s),error:{message:"Network request failed"},response:{status:0,statusText:"Network Error",duration:t}}):e.emit({t:e.getTime(),id:r,method:o,url:e.processUrl(s),response:{status:n.status,statusText:n.statusText,duration:t,contentType:i||void 0,body:l,truncated:c||void 0}})}),n},Object.setPrototypeOf(window.XMLHttpRequest,t),window.XMLHttpRequest.prototype=t.prototype}isTextContentType(e){const t=e.toLowerCase();return tn.some(e=>t.includes(e))}extractRequestBody(e){if(e)try{if("string"==typeof e)return this.truncateBody(e);if(e instanceof URLSearchParams)return this.truncateBody(e.toString());if(e instanceof FormData){const t=[];return e.forEach((e,n)=>{"string"==typeof e?t.push(`${n}=${e}`):t.push(`${n}=[File: ${e.name}]`)}),this.truncateBody(t.join("&"))}if(e instanceof Blob)return`[Blob: ${e.size} bytes, type: ${e.type}]`;if(e instanceof ArrayBuffer)return`[ArrayBuffer: ${e.byteLength} bytes]`;if(ArrayBuffer.isView(e))return`[TypedArray: ${e.byteLength} bytes]`;if(e instanceof Document){const t=new XMLSerializer;return this.truncateBody(t.serializeToString(e))}return"object"==typeof e?this.truncateBody(JSON.stringify(e)):String(e)}catch{return"[Failed to extract request body]"}}truncateBody(e){return e.length<=this.maxBodySize?e:e.slice(0,this.maxBodySize)+"...[truncated]"}getHeaders(e){if(!e)return{};if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e}getResponseHeaders(e){const t={};return e.headers.forEach((e,n)=>{t[n]=e}),t}processUrl(e){const t=en(e);if(!this.redactConfig?.allowDomains)return t;if(t.startsWith("http://")||t.startsWith("https://"))try{const e=new URL(t);if(!this.redactConfig.allowDomains.some(t=>e.hostname.endsWith(t)))return`${e.protocol}//${e.hostname}[REDACTED]`}catch{}return t}redactHeaders(e){if(!this.redactConfig?.maskRequestHeaders)return e;const t={...e};return this.redactConfig.maskRequestHeaders.forEach(e=>{const n=e.toLowerCase();Object.keys(t).forEach(e=>{e.toLowerCase()===n&&(t[e]="[REDACTED]")})}),t}shouldIgnoreUrl(e){return!(!e.endsWith(".map")&&!e.includes(".map?"))||!!this.redactConfig?.ignoreNetworkPatterns&&this.redactConfig.ignoreNetworkPatterns.some(t=>{try{if(t.startsWith("/")&&t.endsWith("/")){return new RegExp(t.slice(1,-1)).test(e)}return e.includes(t)}catch{return e.includes(t)}})}}class rn{constructor(e){this.emit=e,this.name="performance",this.observers=[]}start(){this.observeFCP(),this.observeLCP(),this.observeCLS(),this.observeLongTasks()}stop(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}getTime(){return Math.round(performance.now())}observeFCP(){try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())"first-contentful-paint"===t.name&&this.emit({t:this.getTime(),metric:"FCP",value:Math.round(t.startTime)})});e.observe({type:"paint",buffered:!0}),this.observers.push(e)}catch(e){console.warn("[PerformancePlugin] FCP not supported",e)}}observeLCP(){try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),n=t[t.length-1];n&&this.emit({t:this.getTime(),metric:"LCP",value:Math.round(n.renderTime||n.loadTime||n.startTime),detail:{element:n.element?.tagName,url:n.url}})});e.observe({type:"largest-contentful-paint",buffered:!0}),this.observers.push(e)}catch(e){console.warn("[PerformancePlugin] LCP not supported",e)}}observeCLS(){try{let e=0;const t=new PerformanceObserver(t=>{for(const n of t.getEntries())!n.hadRecentInput&&n.value&&(e+=n.value,this.emit({t:this.getTime(),metric:"CLS",value:e,detail:{entryValue:n.value}}))});t.observe({type:"layout-shift",buffered:!0}),this.observers.push(t)}catch(e){console.warn("[PerformancePlugin] CLS not supported",e)}}observeLongTasks(){try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())this.emit({t:this.getTime(),metric:"LongTask",value:Math.round(t.duration),detail:{startTime:Math.round(t.startTime),name:t.name}})});e.observe({type:"longtask",buffered:!0}),this.observers.push(e)}catch(e){console.warn("[PerformancePlugin] Long Tasks not supported",e)}}}class on{constructor(e){this.emit=e,this.name="resource",this.errorHandler=null,this.observer=null}start(){this.monitorResourceErrors(),this.monitorResourceTiming()}stop(){this.errorHandler&&(window.removeEventListener("error",this.errorHandler,!0),this.errorHandler=null),this.observer&&(this.observer.disconnect(),this.observer=null)}getTime(){return Math.round(performance.now())}monitorResourceErrors(){this.errorHandler=e=>{const t=e.target;if(!(t&&t instanceof HTMLElement))return;const n=t.tagName?.toLowerCase();if(!n)return;let r="",i="";switch(n){case"img":r=t.src,i="image";break;case"script":r=t.src,i="script";break;case"link":r=t.href,i="stylesheet";break;case"video":r=t.src||t.currentSrc,i="video";break;case"audio":r=t.src||t.currentSrc,i="audio";break;case"iframe":r=t.src,i="iframe";break;default:return}r&&i&&this.emit({t:this.getTime(),type:i,url:en(r),status:"failed"})},window.addEventListener("error",this.errorHandler,!0)}monitorResourceTiming(){if("undefined"!=typeof PerformanceObserver)try{this.observer=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{if("resource"===e.entryType){const t=e,n=this.getResourceType(t);if(!n)return;const r=Math.round(t.duration),i=t.transferSize||0,o=0===i&&0===r;(o||r>3e3)&&this.emit({t:this.getTime(),type:n,url:en(t.name),status:o?"failed":"loaded",duration:r,size:i})}})}),this.observer.observe({entryTypes:["resource"]})}catch(e){console.error("[ResourcePlugin] Failed to setup PerformanceObserver:",e)}else console.warn("[ResourcePlugin] PerformanceObserver is not supported")}getResourceType(e){const{initiatorType:t,name:n}=e;if(t)switch(t){case"img":return"image";case"script":return"script";case"link":case"css":return"stylesheet";case"video":return"video";case"audio":return"audio";case"iframe":return"iframe";case"fetch":case"xmlhttprequest":return null}const r=n.split(".").pop()?.split("?")[0]?.toLowerCase();if(r){if(["jpg","jpeg","png","gif","webp","svg","ico"].includes(r))return"image";if(["js","mjs"].includes(r))return"script";if(["css"].includes(r))return"stylesheet";if(["mp4","webm","ogg"].includes(r))return"video";if(["mp3","wav","aac"].includes(r))return"audio";if(["woff","woff2","ttf","otf","eot"].includes(r))return"font"}return null}}class sn{constructor(){this.events={interactions:[],network:[],console:[],performance:[],form:[],resource:[],errors:[],navigation:[]},this.eventCounter=0,this.lastCheckCount=0,this.totalSizeBytes=0}add(e,t){const n=this.estimateEventSize(t);this.events[e].push({...t,_size:n}),this.totalSizeBytes+=n,this.eventCounter++,this.eventCounter-this.lastCheckCount>=100&&(this.lastCheckCount=this.eventCounter,this.checkAndCleanup())}estimateEventSize(e){try{return 2*JSON.stringify(e).length}catch(t){return 1e3}}checkAndCleanup(){this.totalSizeBytes>5242880&&this.cleanupOldEvents()}getSizeBytes(){return this.totalSizeBytes}cleanupOldEvents(){const e=[];for(const o of Object.keys(this.events)){const t=this.events[o];for(let n=0;n<t.length;n++){const r=t[n];e.push({key:o,index:n,t:r.t,size:r._size})}}if(0===e.length)return;e.sort((e,t)=>e.t-t.t);const t=Math.ceil(.3*e.length),n=e.slice(0,t);let r=0;const i=new Map;for(const{key:o,index:s,size:a}of n)i.has(o)||i.set(o,new Set),i.get(o).add(s),r+=a;for(const[o,s]of i)this.events[o]=this.events[o].filter((e,t)=>!s.has(t));this.totalSizeBytes-=r}get(e){return this.events[e].map(e=>{const{_size:t,...n}=e;return n})}getAll(){const e={interactions:[],network:[],console:[],performance:[],form:[],resource:[],errors:[],navigation:[]};for(const t of Object.keys(this.events))e[t]=this.events[t].map(e=>{const{_size:t,...n}=e;return n});return e}getTotalCount(){return Object.values(this.events).reduce((e,t)=>e+t.length,0)}getCounts(){const e={};for(const t of Object.keys(this.events))e[t]=this.events[t].length;return e}clear(){this.events={interactions:[],network:[],console:[],performance:[],form:[],resource:[],errors:[],navigation:[]},this.totalSizeBytes=0,this.eventCounter=0,this.lastCheckCount=0}}class an{constructor(e){this.plugins=new Map,this.options=e,this.store=new sn}start(){this.initPlugins(),this.plugins.forEach(e=>e.start())}stop(){this.plugins.forEach(e=>e.stop())}getEvents(){return this.store.getAll()}getEventCounts(){return this.store.getCounts()}clear(){this.store.clear()}initPlugins(){if(!1!==this.options.interactions){const e=new Zt(e=>this.store.add("interactions",e),this.options.debounce,this.options.redact);this.plugins.set("interaction",e)}if(!1!==this.options.network){const e=new nn(e=>this.store.add("network",e),this.options.redact,this.options.networkCapture);this.plugins.set("network",e)}if(!1!==this.options.console){const e=new Ht(e=>this.store.add("console",e),e=>this.store.add("errors",e),this.options.redact);this.plugins.set("console",e)}if(!1!==this.options.performance){const e=new rn(e=>this.store.add("performance",e));this.plugins.set("performance",e)}if(!1!==this.options.form){const e=new Xt(e=>this.store.add("form",e),this.options.redact);this.plugins.set("form",e)}if(!1!==this.options.resource){const e=new on(e=>this.store.add("resource",e));this.plugins.set("resource",e)}if(!1!==this.options.navigation){const e=new Qt(e=>this.store.add("navigation",e));this.plugins.set("navigation",e)}}}class ln{constructor(e={}){this.events=[],this.options=e}start(){this.options.enabled}stop(){this.stopFn?.()}getEvents(){return this.events}isEnabled(){return!0===this.options.enabled}getReplayData(){if(this.isEnabled())return{enabled:!0,events:this.events}}getEventCount(){return this.events.length}clear(){this.events=[]}}class cn{constructor(e={}){this.recordStartTime=0,this.isRecording=!1,this.options=e,this.coreRecorder=new an({...e.core,redact:e.redact||e.core?.redact}),this.replayRecorder=new ln(e.replay)}start(){this.isRecording?console.warn("[Recorder] Already recording"):(this.recordStartTime=Date.now(),this.isRecording=!0,this.metadata={sessionId:this.generateSessionId(),pageStartTime:performance.timeOrigin,recordStartTime:this.recordStartTime,duration:0,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},href:window.location.href},this.coreRecorder.start(),this.replayRecorder.start())}stop(){this.isRecording?(this.coreRecorder.stop(),this.replayRecorder.stop(),this.metadata.duration=Date.now()-this.recordStartTime,this.isRecording=!1,this.coreRecorder.getEventCounts()):console.warn("[Recorder] Not recording")}isActive(){return this.isRecording}getTime(){return Math.round(performance.now())}export(){return{metadata:{...this.metadata,duration:this.isRecording?Date.now()-this.recordStartTime:this.metadata.duration},core:this.coreRecorder.getEvents(),replay:this.replayRecorder.getReplayData()}}exportCore(){return{metadata:{...this.metadata,duration:this.isRecording?Date.now()-this.recordStartTime:this.metadata.duration},core:this.coreRecorder.getEvents()}}getEventCounts(){const e=this.coreRecorder.getEventCounts(),t=Object.values(e).reduce((e,t)=>e+t,0),n=this.replayRecorder.getEventCount();return{core:e,replay:n,total:t+n}}generateSessionId(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,9)}`}}let un=null;const dn={core:{interactions:!0,network:!0,console:!0,performance:!0,form:!0,resource:!0,navigation:!0},replay:{enabled:!1}};function hn(){gn(),un=new cn(dn),un.start()}function gn(){un&&(un.stop(),un=null)}e.onEvent("recorder:start",()=>{hn()}),e.onEvent("recorder:stop",()=>{gn()}),e.onInvoke("recorder:export",()=>{const e=un?.export();if(!e)return console.warn("[Recorder] No recording data to export"),null;try{return JSON.stringify(e)}catch(t){return console.error("[Recorder] Failed to serialize recording data:",t),JSON.stringify({metadata:e.metadata,core:{interactions:[],network:[],console:[],performance:[],form:[],resource:[],errors:[],navigation:[]},error:"Failed to serialize events"})}}),hn();const mn="__yw_sw_cid__",fn="__yw_sw_clearing__";function pn(){const e=new URLSearchParams(window.location.search).get("__yw_preview_token");if(!e)return null;const t=function(e){try{const t=e.split(".");if(3!==t.length)return null;const n=t[1],r=atob(n.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(r)}catch{return null}}(e);return t&&"string"==typeof t.cid?t.cid:null}(async function(){if(sessionStorage.getItem(fn))return void sessionStorage.removeItem(fn);const e=pn();if(!e)return;if(!(await async function(){if(!("serviceWorker"in navigator))return!1;try{return(await navigator.serviceWorker.getRegistrations()).length>0}catch{return!1}}()))return void localStorage.setItem(mn,e);if(localStorage.getItem(mn)===e)return;localStorage.setItem(mn,e),sessionStorage.setItem(fn,"true"),await async function(){let e=!1;if("serviceWorker"in navigator)try{const t=await navigator.serviceWorker.getRegistrations();t.length>0&&(await Promise.all(t.map(e=>e.unregister())),e=!0)}catch(t){console.warn("[YW] Failed to unregister SW:",t)}if(e&&"caches"in window)try{const e=await caches.keys();e.length>0&&await Promise.all(e.map(e=>caches.delete(e)))}catch(t){console.warn("[YW] Failed to clear caches:",t)}return e}()?window.location.reload():sessionStorage.removeItem(fn)})().catch(e=>{console.warn("[YW] Failed to check version change:",e)});new class{constructor(e){this.editorStyleElement=null,this.isInitialized=!1,this.keyboardHandler=null,this.preventDefault=e=>{e.preventDefault(),e.stopPropagation()},this.handleScroll=()=>{this.messageManager.sendEvent("ve_page_scrolled",void 0)},this.handleWindowBlur=()=>{this.inlineEditor.isEditing()&&this.inlineEditor.endEditing(),this.messageManager.sendEvent("ve_iframe_blurred",void 0)},this.handleWindowFocus=()=>{this.messageManager.sendEvent("ve_iframe_focused",void 0)},this.handleKeyDown=e=>{if(!this.stateManager.isVisualEditingEnabled())return;const t=navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey,n=this.inlineEditor.getEditingElement(),r=n?.contains(e.target);if(!r)return t&&"z"===e.key.toLowerCase()&&!e.shiftKey?(e.preventDefault(),e.stopPropagation(),void this.handleUndo()):t&&("z"===e.key.toLowerCase()&&e.shiftKey||"y"===e.key.toLowerCase())?(e.preventDefault(),e.stopPropagation(),void this.handleRedo()):void 0;t&&("z"===e.key.toLowerCase()||e.key.toLowerCase())},this.enableLogging=e.enableLogging??!1,this.messageManager=e.messageManager,this.stateManager=new X,this.commandHistory=new b,this.inlineEditor=new J(this.stateManager),this.previewManager=new Y,window.__visualEditorCommunication=this,this.setupEventHandlers(),this.setupMessageHandlers()}setup(){this.messageManager.sendEvent("ve_setup_ready",void 0),this.enableLogging&&console.log(" [Runtime] VisualEditor setup completed")}setupEventHandlers(){this.inlineEditor.setTextChangeHandler(this.handleInlineTextChange.bind(this)),this.inlineEditor.setEditStartHandler(this.handleInlineEditStart.bind(this)),this.inlineEditor.setEditEndHandler(this.handleInlineEditEnd.bind(this))}setupMessageHandlers(){this.messageManager.onEvent("ve_toggle_editing",this.handleToggleVisualEditing.bind(this)),this.messageManager.onInvoke("ve_update_element",this.handleUpdateElement.bind(this)),this.messageManager.onEvent("ve_preview_element",this.handlePreviewElement.bind(this)),this.messageManager.onEvent("ve_cancel_preview",this.handleCancelPreview.bind(this)),this.messageManager.onEvent("ve_revert_element",this.handleRevertElement.bind(this)),this.messageManager.onEvent("ve_revert_all",this.handleRevertAll.bind(this)),this.messageManager.onEvent("ve_delete_element",this.handleDeleteElement.bind(this)),this.messageManager.onInvoke("ve_get_all_modifications",this.handleGetAllModifications.bind(this)),this.messageManager.onEvent("ve_cancel_selection",this.handleCancelSelection.bind(this)),this.messageManager.onEvent("ve_undo",this.handleUndoFromParent.bind(this)),this.messageManager.onEvent("ve_redo",this.handleRedoFromParent.bind(this))}addDOMEventListeners(){document.addEventListener("click",this.handleDOMClick.bind(this),{capture:!0}),document.addEventListener("mousedown",this.handleDOMMouseDown.bind(this),{capture:!0}),document.addEventListener("pointerdown",this.handleDOMPointerDown.bind(this),{capture:!0}),document.addEventListener("mouseover",this.handleDOMMouseOver.bind(this)),document.addEventListener("mouseout",this.handleDOMMouseOut.bind(this)),document.addEventListener("scroll",this.handleScroll.bind(this),!0),window.addEventListener("scroll",this.handleScroll.bind(this),!0),this.keyboardHandler=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.keyboardHandler,!0),window.addEventListener("blur",this.handleWindowBlur),window.addEventListener("focus",this.handleWindowFocus),document.addEventListener("submit",this.preventDefault,!0),document.addEventListener("touchstart",this.preventDefault,!0),document.addEventListener("touchend",this.preventDefault,!0)}removeDOMEventListeners(){document.removeEventListener("click",this.handleDOMClick),document.removeEventListener("mousedown",this.handleDOMMouseDown),document.removeEventListener("pointerdown",this.handleDOMPointerDown),document.removeEventListener("mouseover",this.handleDOMMouseOver),document.removeEventListener("mouseout",this.handleDOMMouseOut),document.removeEventListener("scroll",this.handleScroll,!0),window.removeEventListener("scroll",this.handleScroll,!0),this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler,!0),this.keyboardHandler=null),window.removeEventListener("blur",this.handleWindowBlur),window.removeEventListener("focus",this.handleWindowFocus),document.removeEventListener("submit",this.preventDefault,!0),document.removeEventListener("touchstart",this.preventDefault,!0),document.removeEventListener("touchend",this.preventDefault,!0)}handleDOMClick(e){this.stateManager.isVisualEditingEnabled()&&this.processElementInteraction(e,!1)}handleDOMMouseDown(e){if(!this.stateManager.isVisualEditingEnabled())return;const t=e.target;this.shouldHandleOnPointerOrMouseDown(t,e)&&this.processElementInteraction(e,!0)}handleDOMPointerDown(e){if(!this.stateManager.isVisualEditingEnabled())return;const t=e.target;this.shouldHandleOnPointerOrMouseDown(t,e)&&this.processElementInteraction(e,!0)}shouldHandleOnPointerOrMouseDown(e,t){return 0===t.button&&(!!(e instanceof HTMLButtonElement&&e.disabled)||(!!(e instanceof HTMLInputElement&&e.disabled)||(!!(e instanceof HTMLSelectElement&&e.disabled)||(!!(e instanceof HTMLTextAreaElement&&e.disabled)||"true"===e.getAttribute("aria-disabled")))))}processElementInteraction(e,t=!1){e.stopPropagation(),e.stopImmediatePropagation();const{selectTarget:n,editTarget:r,checkStatus:i}=this.inlineEditor.checkClickElement(e);if(r&&this.commandHistory.saveElementInfo(r),e.preventDefault(),"click_same"===i){const e=f(n);return void this.sendSelectedElements([e])}e.metaKey||e.ctrlKey?this.handleMultiSelect(n):this.handleElementClick(n)}handleDOMMouseOver(e){if(!this.stateManager.isVisualEditingEnabled())return;const t=e.target,n=this.stateManager.getSelectedElement();if(t!==n?.element){const e=this.stateManager.getHoveredElement();if(t!==e?.element){const e=t.hasAttribute("data-yw-auto")?t.parentElement:t,n=e.getAttribute("data-yw");if(n){const t=l(n);this.stateManager.setHoveredElement(e,t)}else this.stateManager.setHoveredElement(e,[e]);m(t)&&t.classList.add("yw_text_editable")}}}handleDOMMouseOut(e){if(!this.stateManager.isVisualEditingEnabled())return;const t=e.target;if(t){const e=this.stateManager.getHoveredElement();e&&e.element===t&&this.stateManager.clearHoveredElement()}}handleUndo(){if(this.commandHistory.canUndo()){this.commandHistory.undo()&&(this.enableLogging&&console.log(" [Runtime] Undo operation completed"),this.notifyModificationsChanged(),this.updateSelectedElementState())}else this.enableLogging&&console.log(" [Runtime] No commands to undo")}handleRedo(){if(this.commandHistory.canRedo()){this.commandHistory.redo()&&(this.enableLogging&&console.log(" [Runtime] Redo operation completed"),this.notifyModificationsChanged(),this.updateSelectedElementState())}else this.enableLogging&&console.log(" [Runtime] No commands to redo")}handleElementClick(e){const t=this.stateManager.getSelectedElement();t&&t.element===e||this.stateManager.clearAllSelections();const n=this.commandHistory.saveElementInfo(e);this.stateManager.setSelectedElement(e),this.sendSelectedElements([n])}handleMultiSelect(e){this.inlineEditor.endEditing(),this.stateManager.convertSingleToMultiSelection(),this.stateManager.toggleMultiSelectedElement(e),this.sendSelectedElements(Array.from(this.stateManager.getMultiSelectedElements().values()).map(e=>f(e)))}handleInlineTextChange(e,t,n){const r=c(e),i=e.hasAttribute("data-yw-t")?function(e){if("string"==typeof e)return l(e);{const t=document.evaluate(e.xpath,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),n=[];for(let e=0;e<t.snapshotLength;e++){const r=t.snapshotItem(e);r&&n.push(r)}return n}}(r):[e],o=new p(r,i,t,n);this.commandHistory.executeCommand(o),this.notifyModificationsChanged()}handleInlineEditStart(e,t){const n=c(e);this.messageManager.sendEvent("ve_inline_edit_start",{elementId:n,elementType:e.tagName.toLowerCase(),initialText:t}),this.enableLogging&&console.log(" [Runtime] Inline editing started:",n,t)}handleInlineEditEnd(e,t,n,r){const i=c(e);this.messageManager.sendEvent("ve_inline_edit_end",{elementId:i,elementType:e.tagName.toLowerCase(),finalText:t,initialText:n,duration:r}),this.enableLogging&&console.log(" [Runtime] Inline editing ended:",i,t,`${r}ms`)}handleToggleVisualEditing(e){this.stateManager.setVisualEditingEnabled(e.enabled),e.enabled?(this.isInitialized||(this.addEditorStyles(),this.isInitialized=!0),this.addDOMEventListeners(),this.enableLogging&&console.log(" [Runtime] Visual editing enabled")):(this.removeDOMEventListeners(),this.inlineEditor.endEditing(),this.previewManager.clearAllPreviews(),this.stateManager.clearAllSelections(),this.enableLogging&&console.log(" [Runtime] Visual editing disabled"))}handleUpdateElement(e){this.enableLogging&&console.log(" [Runtime] Element update request received:",e),this.previewManager.cancelPreview(e.elementId);const t=this.stateManager.getSelectedElement();if(!t||!d(e.elementId,t.identifier))throw this.enableLogging&&console.warn(" [Runtime] Element not matched or no element selected"),new Error(`Element not found or not selected: ${e.elementId}`);const{updateType:n,text:r,imageUrl:i,targetStyles:o,linkUrl:s}=e;this.enableLogging&&console.log(" [Runtime] Element matched successfully, update type:",n);let a=null;const{elementGroup:l}=t;switch(n){case"text":void 0!==r&&(a=new p(e.elementId,l,r));break;case"inline-style":this.enableLogging&&console.log(" [Runtime] Processing inline style update, target styles:",o),o&&(a=new y(e.elementId,l,o));break;case"image":void 0!==i&&(a=new v(e.elementId,t.element.hasAttribute("data-yw-i")?l:[t.element],i));break;case"link":void 0!==s&&(a=new w(e.elementId,l,s))}if(!a)throw this.enableLogging&&console.warn(" [Runtime] Invalid update data"),new Error(`Invalid update data for element: ${e.elementId}`);this.commandHistory.executeCommand(a),this.enableLogging&&console.log(" [Runtime] Command executed:",n),this.notifyModificationsChanged();const c=f(t.element);return this.enableLogging&&console.log(" [Runtime] Returning updated element info:",c),c}handlePreviewElement(e){const t=this.stateManager.getSelectedElement();if(!t||!d(e.elementId,t.identifier))throw this.enableLogging&&console.warn(" [Runtime] Element not matched or no element selected"),new Error(`Element not found or not selected: ${e.elementId}`);const{elementId:n,updateType:r,targetStyles:i}=e;this.enableLogging&&console.log(" [Runtime] Element matched successfully, update type:",r);const{elementGroup:o}=t;this.enableLogging&&console.log(" [Runtime] Preview request received:",e),"inline-style"===r&&i&&this.previewManager.previewStyles(n,o,i)}handleCancelPreview(e){this.enableLogging&&console.log(" [Runtime] Cancel preview request received:",e.elementId),this.previewManager.cancelPreview(e.elementId)}handleRevertElement(e){this.enableLogging&&console.log(" [Runtime] Reverting element:",e.elementId),this.commandHistory.undoElement(e.elementId),this.notifyModificationsChanged()}handleRevertAll(){this.commandHistory.revertAllModifiedElements()}handleDeleteElement(e){const{elementId:t}=e;this.enableLogging&&console.log(" [Runtime] Deleting element:",e.elementId);const n=this.stateManager.getSelectedElement();if(!n)throw this.enableLogging&&console.warn(" [Runtime] Element not matched or no element selected"),new Error(`Element not found or not selected: ${e.elementId}`);const{elementGroup:r}=n,i=new E(t,r);this.commandHistory.executeCommand(i),this.stateManager.clearSelectedElement(),this.sendSelectedElements([]),this.enableLogging&&console.log(" [Runtime] Element deleted:",t,`${r.length} elements total`),this.notifyModificationsChanged()}handleGetAllModifications(){return this.enableLogging&&console.log(" [Runtime] Getting all modification info"),this.commandHistory.getAllModifications()}notifyModificationsChanged(){this.enableLogging&&console.log(" [Runtime] Getting all modifications from CommandHistory...");const e=this.commandHistory.getAllModifications();this.enableLogging&&console.log(" [Runtime] Got modifications:",{count:e.length,edits:e}),this.messageManager.sendEvent("ve_modifications_changed",{visualEdits:e}),this.enableLogging&&console.log(" [Runtime] Notified parent about modifications change:",e.length,"edits")}handleCancelSelection(e){if(e.identifier)for(const[t,n]of this.stateManager.getMultiSelectedElements()){if(d(c(n),e.identifier)){this.stateManager.removeMultiSelectedElement(t);break}}}handleUndoFromParent(){this.handleUndo()}handleRedoFromParent(){this.handleRedo()}updateSelectedElementState(){const e=this.stateManager.getSelectedElement();if(e&&e.element){const t=f(e.element);this.messageManager.sendEvent("ve_element_updated",{elementInfo:t})}}handleViteBeforeUpdate(){this.enableLogging&&console.log(" [Runtime] HMR: Preparing hot update, reverting all modifications"),this.commandHistory.revertAllModifiedElements(),this.inlineEditor.endEditing(),this.stateManager.clearAllStates(),this.commandHistory.clearAllHistory()}handleViteAfterUpdate(){this.enableLogging&&console.log(" [Runtime] HMR: Hot update completed, waiting for React re-render"),this.waitForReactUpdate(()=>{this.sendHMRComplete()})}waitForReactUpdate(e){requestAnimationFrame(()=>{setTimeout(()=>{e()},50)})}sendSelectedElements(e){this.messageManager.sendEvent("ve_select_elements",{elementInfos:e})}sendInlineEdit(e,t){this.messageManager.sendEvent("ve_inline_edit",{elementId:e,text:t})}sendHMRComplete(){this.messageManager.sendEvent("ve_hmr_complete",{timestamp:Date.now()})}addEditorStyles(){this.editorStyleElement||(this.editorStyleElement=document.createElement("style"),this.editorStyleElement.textContent='\n      [data-yw-t], .yw_text_editable {\n        cursor: text !important;\n      }\n      [contenteditable="true"]:focus, [contenteditable="plaintext-only"]:focus {\n        outline: none !important;\n      }\n      .yw-ve-deleted {\n        display: none !important;\n      }\n      [data-set-caret] {\n        caret-color: #55644A !important;\n      }\n    ',document.head.appendChild(this.editorStyleElement))}destroy(){this.removeDOMEventListeners(),this.inlineEditor.destroy(),this.previewManager.destroy(),this.commandHistory.clearAllHistory(),this.stateManager.clearAllStates(),this.editorStyleElement&&(this.editorStyleElement.remove(),this.editorStyleElement=null),this.isInitialized=!1}}({messageManager:e,enableLogging:!1}).setup()});
